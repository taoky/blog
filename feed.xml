<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="zh">
  <generator uri="http://jekyllrb.com" version="3.8.7">Jekyll</generator>
  
  
  <link href="https://taoky.github.io/feed.xml" rel="self" type="application/atom+xml" />
  <link href="https://taoky.github.io/" rel="alternate" type="text/html" hreflang="zh" />
  <updated>2021-01-01T16:41:10+00:00</updated>
  <id>https://taoky.github.io//</id>

  
    <title type="html">taoky’s blog</title>
  

  
    <subtitle>taoky's blog</subtitle>
  

  
    <author>
        <name>taoky</name>
      
      
    </author>
  

  
  
    <entry>
      
      <title type="html">epoll 的故事</title>
      
      
      <link href="https://taoky.github.io/2019-07-08/epoll-101.html" rel="alternate" type="text/html" title="epoll 的故事" />
      
      <published>2019-07-08T04:33:00+00:00</published>
      <updated>2019-07-08T04:33:00+00:00</updated>
      <id>https://taoky.github.io/2019-07-08/epoll-101</id>
      <content type="html" xml:base="https://taoky.github.io/2019-07-08/epoll-101.html">&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;epoll&lt;/code&gt; 是 Linux 下的一种 I/O 事件通知机制&lt;sup id=&quot;fnref:1&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;——这样写的话，总让人感觉不知所云。写这个主要是因为今年的 OSH 课程有一个写高性能静态页面的网页服务器的实验。&lt;code class=&quot;highlighter-rouge&quot;&gt;epoll&lt;/code&gt; 作为一种提高性能的方式被不少人拿去用，虽然理解与写 &lt;code class=&quot;highlighter-rouge&quot;&gt;epoll&lt;/code&gt; 代码并不是什么容易的事情，而且最后还是会有各种各样的问题。&lt;/p&gt;

&lt;p&gt;在介绍 &lt;code class=&quot;highlighter-rouge&quot;&gt;epoll&lt;/code&gt; 之前，不如让我们来看看，&lt;code class=&quot;highlighter-rouge&quot;&gt;epoll&lt;/code&gt; 到底是怎么出现的。&lt;/p&gt;

&lt;h2 id=&quot;网页服务器与-c10k-问题&quot;&gt;网页服务器与 C10K 问题&lt;/h2&gt;

&lt;p&gt;C10K 问题指同时处理一万个并发连接时的优化问题&lt;sup id=&quot;fnref:2&quot;&gt;&lt;a href=&quot;#fn:2&quot; class=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;。&lt;/p&gt;

&lt;h3 id=&quot;起初&quot;&gt;起初……&lt;/h3&gt;

&lt;p&gt;最开始的时候，网页服务器处理连接的做法非常简单：&lt;code class=&quot;highlighter-rouge&quot;&gt;accept()&lt;/code&gt; 阻塞在那，接收到连接之后就处理、返回数据。但这样简单的做法在多用户的情况下效果是很差的：如果我在下载一个超大的文件，其他用户的连接就根本无法被处理，这显然是无法接受的。&lt;/p&gt;

&lt;p&gt;既然要同时处理多个连接，那 &lt;code class=&quot;highlighter-rouge&quot;&gt;fork()&lt;/code&gt; 总可以吧——接收到连接后先 &lt;code class=&quot;highlighter-rouge&quot;&gt;fork()&lt;/code&gt; 一下，新进程去处理当前请求，父进程继续 &lt;code class=&quot;highlighter-rouge&quot;&gt;accept()&lt;/code&gt;，或者我 &lt;code class=&quot;highlighter-rouge&quot;&gt;pthread_create()&lt;/code&gt; 创建新线程也行。这样确实部分解决了上一段的问题，但是创建新的进程/线程是有比较大的开销的。&lt;/p&gt;

&lt;p&gt;既然开销大，那么我能不能在最开始的时候就先创建一些进程/线程呢？这种做法最后就变成了进程/线程池（Apache prefork 就是这样做的）。看起来，我们很好地解决了这个问题，但是……&lt;/p&gt;

&lt;h3 id=&quot;一万个并发连接--一万个进程线程&quot;&gt;一万个并发连接 = 一万个进程/线程？&lt;/h3&gt;

&lt;p&gt;很遗憾的事情是，我们没有一万个 CPU 核心可以来并行运行这些进程/线程。让一万个进程/线程同时保持高性能处理连接是不切实际的。&lt;/p&gt;

&lt;p&gt;所以，我们能否让一个进程/线程&lt;strong&gt;同时&lt;/strong&gt;处理多个连接？答案当然是可以的：这就是 I/O 复用。&lt;/p&gt;

&lt;h3 id=&quot;select&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;select()&lt;/code&gt;&lt;/h3&gt;

&lt;p&gt;我们可以注意到，在处理 socket 文件描述符的时候，有一些操作是阻塞的：这包括了读取 (&lt;code class=&quot;highlighter-rouge&quot;&gt;read&lt;/code&gt;)、写入 (&lt;code class=&quot;highlighter-rouge&quot;&gt;write&lt;/code&gt;) 以及接受连接 (&lt;code class=&quot;highlighter-rouge&quot;&gt;accept&lt;/code&gt;) 等等。如果我们有一种方法，能够让我们的进程知道某个文件描述符&lt;strong&gt;已经准备&lt;/strong&gt;好某个操作的话，每次只要把准备好的描述符拿出来做处理就可以了，在执行这些阻塞操作的时候也就不会一直卡在那儿了。这样我们的处理流程就是：&lt;/p&gt;

&lt;p&gt;首先由某个函数来告诉我们文件描述符准备好读/写，然后我们对那个文件描述符做短小快速的处理，最后回到那个函数，不停循环。我们不用太担心这样对性能会不会带来比较大的影响，因为网络的 I/O 相比 CPU 来讲慢得多。这样的话我们的单个进程/线程也可以处理好多个连接了。&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;select()&lt;/code&gt;&lt;sup id=&quot;fnref:3&quot;&gt;&lt;a href=&quot;#fn:3&quot; class=&quot;footnote&quot;&gt;3&lt;/a&gt;&lt;/sup&gt; 就可以做到「通知」的作用。它使用的 &lt;code class=&quot;highlighter-rouge&quot;&gt;fd_set&lt;/code&gt; 结构体（其实是一个定长的 buffer）中存储了多个描述符。描述符分成了三类——准备好读取、准备好写入、发生错误。函数原型如下。&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nfds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fd_set&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;readfds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fd_set&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;writefds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
           &lt;span class=&quot;n&quot;&gt;fd_set&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exceptfds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timeval&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;看起来很好，但是 &lt;code class=&quot;highlighter-rouge&quot;&gt;select()&lt;/code&gt; 仍有一些问题。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;描述符数量有限制。POSIX 标准允许实现自己来定义数量上限，Linux 内核也没有硬性限制，但是 glibc 有——它把 &lt;code class=&quot;highlighter-rouge&quot;&gt;FD_SETSIZE&lt;/code&gt; 直接定义为了 1024。&lt;/li&gt;
  &lt;li&gt;第二个问题在于 &lt;code class=&quot;highlighter-rouge&quot;&gt;nfds&lt;/code&gt; 这个参数：&lt;code class=&quot;highlighter-rouge&quot;&gt;select()&lt;/code&gt; 会检查 0 到 &lt;code class=&quot;highlighter-rouge&quot;&gt;nfds - 1&lt;/code&gt; 在内的所有文件描述符的情况——这很 &lt;code class=&quot;highlighter-rouge&quot;&gt;O(n)&lt;/code&gt;。在大量连接的情况下，我们当然希望轮询的时间复杂度越低越好。&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;select()&lt;/code&gt; 会改变 &lt;code class=&quot;highlighter-rouge&quot;&gt;fd_set&lt;/code&gt; 结构体的内容，每次调用都要重新初始化。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;poll&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;poll()&lt;/code&gt;&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;poll()&lt;/code&gt; 是另一种 I/O 复用的函数。它和 &lt;code class=&quot;highlighter-rouge&quot;&gt;select()&lt;/code&gt; 类似。&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;poll&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pollfd&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nfds_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nfds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;timeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pollfd&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  	&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;   &lt;span class=&quot;n&quot;&gt;fd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;         &lt;span class=&quot;cm&quot;&gt;/* file descriptor */&lt;/span&gt;
  	&lt;span class=&quot;kt&quot;&gt;short&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;events&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;     &lt;span class=&quot;cm&quot;&gt;/* requested events */&lt;/span&gt;
  	&lt;span class=&quot;kt&quot;&gt;short&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;revents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;    &lt;span class=&quot;cm&quot;&gt;/* returned events */&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;这里，&lt;code class=&quot;highlighter-rouge&quot;&gt;poll()&lt;/code&gt; 解决了 &lt;code class=&quot;highlighter-rouge&quot;&gt;select()&lt;/code&gt; 的描述符数量和重新初始化的问题，但是 &lt;code class=&quot;highlighter-rouge&quot;&gt;O(n)&lt;/code&gt; 的性能问题还是没能得到解决，所以在 Linux 中就出现了 &lt;code class=&quot;highlighter-rouge&quot;&gt;epoll()&lt;/code&gt;。&lt;/p&gt;

&lt;h2 id=&quot;epoll-简介&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;epoll()&lt;/code&gt; 简介&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;epoll()&lt;/code&gt; 能够用 &lt;code class=&quot;highlighter-rouge&quot;&gt;O(1)&lt;/code&gt; 的时间复杂度去监控文件描述符，解决了 &lt;code class=&quot;highlighter-rouge&quot;&gt;poll()&lt;/code&gt; 的问题。与 &lt;code class=&quot;highlighter-rouge&quot;&gt;select()&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;poll()&lt;/code&gt; 不同，它不是一个「跨 (POSIX) 平台」的解决方案，例如在 FreeBSD 中，与 &lt;code class=&quot;highlighter-rouge&quot;&gt;epoll&lt;/code&gt; 相似的是 &lt;code class=&quot;highlighter-rouge&quot;&gt;kqueue&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;相比于前两者来说，&lt;code class=&quot;highlighter-rouge&quot;&gt;epoll&lt;/code&gt; 也更加复杂了。它有三个系列函数：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;epoll_create()&lt;/code&gt;: 创建 &lt;code class=&quot;highlighter-rouge&quot;&gt;epoll&lt;/code&gt; 实例。&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;epoll_ctl()&lt;/code&gt;: 向 &lt;code class=&quot;highlighter-rouge&quot;&gt;epoll&lt;/code&gt; 实例注册文件描述符，可以设置添加、修改、删除目标文件描述符。&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;epoll_wait()&lt;/code&gt;: 等待 I/O 事件。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;水平触发-lt-与边缘触发-et&quot;&gt;水平触发 (LT) 与边缘触发 (ET)&lt;/h3&gt;

&lt;p&gt;这个术语总有种数电的感觉。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/pictures/epoll/lt-strange-example.gif&quot; alt=&quot;A bad example of level trigger&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;&lt;del&gt;呆唯逗梓喵——一个水平触发的非典型示例&lt;/del&gt;&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;简单地说，水平触发时，只要某个文件描述符处在准备好了的状态，&lt;code class=&quot;highlighter-rouge&quot;&gt;epoll&lt;/code&gt; 就会一直告诉你；边缘触发时，某个文件描述符准备好后，&lt;code class=&quot;highlighter-rouge&quot;&gt;epoll&lt;/code&gt; 只会告诉你一次，或者说 &lt;code class=&quot;highlighter-rouge&quot;&gt;epoll&lt;/code&gt; 只会在描述符状态变化的时候告诉你。边缘触发是 &lt;code class=&quot;highlighter-rouge&quot;&gt;epoll&lt;/code&gt; 新带来的特性。&lt;/p&gt;

&lt;p&gt;文档中举了一个例子：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;某个文件描述符的读端 &lt;code class=&quot;highlighter-rouge&quot;&gt;rfd&lt;/code&gt; 在 &lt;code class=&quot;highlighter-rouge&quot;&gt;epoll&lt;/code&gt; 实例中注册。&lt;/li&gt;
  &lt;li&gt;有一个 pipe writer 在管道写端写入了 2 kB 数据。&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;epoll_wait()&lt;/code&gt; 函数返回 &lt;code class=&quot;highlighter-rouge&quot;&gt;rfd&lt;/code&gt;，标记它已经准备好读取了。&lt;/li&gt;
  &lt;li&gt;Pipe reader 在管道读端读取了 1 kB 数据。（之后回到 &lt;code class=&quot;highlighter-rouge&quot;&gt;epoll_wait()&lt;/code&gt;）&lt;/li&gt;
  &lt;li&gt;如果是水平触发，那么 &lt;code class=&quot;highlighter-rouge&quot;&gt;epoll_wait()&lt;/code&gt; 不会阻塞（因为还能读），你可以继续愉快地读取数据；但边缘触发时就会阻塞住，因为文件描述符的状态没有发生变化。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;如果使用边缘触发，那么就要将文件描述符设置为非阻塞的。因为由上一个例子可以看到，在边缘触发状态下，如果数据没有读/写完就 &lt;code class=&quot;highlighter-rouge&quot;&gt;epoll_wait()&lt;/code&gt; 的话（&lt;code class=&quot;highlighter-rouge&quot;&gt;read()&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;write()&lt;/code&gt; &lt;strong&gt;不能保证&lt;/strong&gt;一定能把你所指定数量字节的信息都读/写完），那么你就永远不会再知道你还可以读/写这个文件描述符了。因此为了完成读写的任务，就不得不循环 &lt;code class=&quot;highlighter-rouge&quot;&gt;read()&lt;/code&gt; 或者 &lt;code class=&quot;highlighter-rouge&quot;&gt;write()&lt;/code&gt;，直到最后一次确认没有东西可以再读/写了。如果文件描述符是阻塞的话，最后一次执行读写函数的时候就会卡在那里&lt;sup id=&quot;fnref:4&quot;&gt;&lt;a href=&quot;#fn:4&quot; class=&quot;footnote&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;。&lt;/p&gt;

&lt;p&gt;文档对使用边缘触发给出的建议是：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;使用非阻塞的文件描述符。&lt;/li&gt;
  &lt;li&gt;直到 &lt;code class=&quot;highlighter-rouge&quot;&gt;read()&lt;/code&gt; 或者 &lt;code class=&quot;highlighter-rouge&quot;&gt;write()&lt;/code&gt; 返回 &lt;code class=&quot;highlighter-rouge&quot;&gt;EAGAIN&lt;/code&gt;，再等待 I/O 事件。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;一般来说，边缘触发的性能更好，但是编写也更费劲一些。&lt;/p&gt;

&lt;h3 id=&quot;epoll_event-结构中可用的事件类型&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;epoll_event&lt;/code&gt; 结构中可用的事件类型&lt;/h3&gt;

&lt;p&gt;以下根据 &lt;code class=&quot;highlighter-rouge&quot;&gt;epoll_ctl()&lt;/code&gt; 的文档整理，可能会有错误，所以我尽量附上了参考的链接。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;EPOLLIN&lt;/code&gt;: 输入 (&lt;code class=&quot;highlighter-rouge&quot;&gt;read&lt;/code&gt;) 事件。&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;EPOLLOUT&lt;/code&gt;: 输出 (&lt;code class=&quot;highlighter-rouge&quot;&gt;write&lt;/code&gt;) 事件。&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;EPOLLRDHUP&lt;/code&gt;: 对方关闭连接，或者 shutdown 了写入端的事件。
    &lt;ul&gt;
      &lt;li&gt;「在边缘触发的情况下判断对方 shutdown 连接的时候很有用」。这可以使代码更简单，否则就需要识别到 &lt;code class=&quot;highlighter-rouge&quot;&gt;EPOLLIN&lt;/code&gt; 之后跑一次 &lt;code class=&quot;highlighter-rouge&quot;&gt;read()&lt;/code&gt;，返回 0 后判断对方已经 shutdown 了写入端&lt;sup id=&quot;fnref:5&quot;&gt;&lt;a href=&quot;#fn:5&quot; class=&quot;footnote&quot;&gt;5&lt;/a&gt;&lt;/sup&gt;。&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;EPOLLPRI&lt;/code&gt;: 文件描述符异常（接收紧急数据&lt;sup id=&quot;fnref:6&quot;&gt;&lt;a href=&quot;#fn:6&quot; class=&quot;footnote&quot;&gt;6&lt;/a&gt;&lt;/sup&gt;）。&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;EPOLLERR&lt;/code&gt;: 文件描述符错误。读取端被关闭后写入端也会报这个事件。不需要特殊指定。&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;EPOLLHUP&lt;/code&gt;: 文件描述符被「挂断」，对方 shutdown 或关闭了连接&lt;sup id=&quot;fnref:7&quot;&gt;&lt;a href=&quot;#fn:7&quot; class=&quot;footnote&quot;&gt;7&lt;/a&gt;&lt;/sup&gt;。&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;EPOLLET&lt;/code&gt;: 边缘触发。&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;EPOLLONESHOT&lt;/code&gt;: 当文件描述符从 &lt;code class=&quot;highlighter-rouge&quot;&gt;epoll_wait()&lt;/code&gt; 中被拿出来后，就不会再被其他对 &lt;code class=&quot;highlighter-rouge&quot;&gt;epoll_wait()&lt;/code&gt; 的调用中拿出来了。例如，多个线程使用同一个 &lt;code class=&quot;highlighter-rouge&quot;&gt;epoll&lt;/code&gt; 实例的时候，当某个线程拿出某个文件描述符的时候，即使这个文件描述符在处理的过程中发生了事件，其他线程也不会接收到，避免了线程之间的竞争的问题。&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;EPOLLWAKEUP&lt;/code&gt;: 保证事件在等待/处理的时候，系统不会进入休眠状态。&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;EPOLLEXCLUSIVE&lt;/code&gt;: 保证一个事件发生的时候，只有一个进程/线程会被唤醒。用 &lt;code class=&quot;highlighter-rouge&quot;&gt;EPOLLONESHOT&lt;/code&gt; 也能达到类似的效果，只是每次都额外多出了一个 &lt;code class=&quot;highlighter-rouge&quot;&gt;epoll_ctl()&lt;/code&gt; 系统调用&lt;sup id=&quot;fnref:8&quot;&gt;&lt;a href=&quot;#fn:8&quot; class=&quot;footnote&quot;&gt;8&lt;/a&gt;&lt;/sup&gt;。&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;实现网页服务器的思路与一些问题&quot;&gt;实现网页服务器的思路与一些问题&lt;/h2&gt;

&lt;p&gt;&lt;em&gt;这里没有完整的实现代码，因为我写得并不好，完美实现需要的功能是一件很困难的事情。&lt;/em&gt;&lt;/p&gt;

&lt;h3 id=&quot;有限状态机&quot;&gt;有限状态机&lt;/h3&gt;

&lt;p&gt;假设我们的服务器功能很简单：从用户读取一些信息（比如说 HTTP 头），经过处理后向用户返回一些信息。如果要做到快速、安全、可靠的话，我们就不得不考虑以下的问题：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;每一阶段的时间不能太长，否则用户的延迟会大大提升。&lt;/li&gt;
  &lt;li&gt;网络并不可靠：用户可能不会一次性把数据发送过来，我们有时也没有办法一次性给用户发送所有需要的数据。如果单纯在一个状态中处理完所有的输入或输出，那么当数据很大，或者丢包率很高的情况下，单个进程/线程会花大量的时间在一个连接上，无法为其他用户提供服务了。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;这样的话，我们就不得不在每次切回 &lt;code class=&quot;highlighter-rouge&quot;&gt;epoll_wait()&lt;/code&gt; 时维护每个连接已有的状态（比如说接收到了哪些数据、发送了哪些数据），编程的复杂度也大大提高了。&lt;/p&gt;

&lt;h3 id=&quot;惊群-thundering-herd&quot;&gt;惊群 (thundering herd)&lt;/h3&gt;

&lt;p&gt;理论上，假设我们的 CPU 有 n 个核心，我们的网页服务器在启用 n 个进程/线程的时候性能是最好的。但我们服务器的 socket 只有一个，那么很自然的想法就是把这个 socket 分享给所有进程/线程。&lt;/p&gt;

&lt;p&gt;这没什么问题，但是比如说我们把服务器的 socket 放在了 &lt;code class=&quot;highlighter-rouge&quot;&gt;epoll&lt;/code&gt; 实例中，在 &lt;code class=&quot;highlighter-rouge&quot;&gt;accept()&lt;/code&gt; 的时候，一个连接可能会唤起多个进程，但是最后只有一个进程会成功，其他被唤醒的进程徒劳无功。这就是惊群现象。&lt;/p&gt;

&lt;p&gt;以上提到的 &lt;code class=&quot;highlighter-rouge&quot;&gt;EPOLLONESHOT&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;EPOLLEXCLUSIVE&lt;/code&gt; 可以部分解决这样的惊群问题，除此之外，使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;SO_REUSEPORT&lt;/code&gt; 设置监听的 socket，使多个 socket 共享同一个端口，也可以缓解这种问题。但是：&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;The best and the only scalable approach is to use recent Kernel 4.5+ and use level-triggered events with &lt;code class=&quot;highlighter-rouge&quot;&gt;EPOLLEXCLUSIVE&lt;/code&gt; flag. This will ensure only one thread is woken for an event, avoid “thundering herd” issue and scale properly across multiple CPU’s.&lt;sup id=&quot;fnref:8:1&quot;&gt;&lt;a href=&quot;#fn:8&quot; class=&quot;footnote&quot;&gt;8&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;或许真的拿 &lt;code class=&quot;highlighter-rouge&quot;&gt;epoll&lt;/code&gt; 来实现一个正确、高效的服务器，真的不是什么容易的事情啊……&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;这篇是当初写完网页服务器的实验之后想写的，当初写实验的时候就花了好几天查 &lt;code class=&quot;highlighter-rouge&quot;&gt;epoll&lt;/code&gt; 的资料，迷迷糊糊的；这几天又查了一些资料，实话讲比原来清楚了一些，但我还是无法保证这里的每句话都是正确的。&lt;/p&gt;

&lt;p&gt;就这样吧……&lt;/p&gt;

&lt;hr /&gt;

&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Epoll&quot;&gt;https://en.wikipedia.org/wiki/Epoll&lt;/a&gt; &lt;a href=&quot;#fnref:1&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/C10k_problem&quot;&gt;https://en.wikipedia.org/wiki/C10k_problem&lt;/a&gt; &lt;a href=&quot;#fnref:2&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:3&quot;&gt;
      &lt;p&gt;参考了 CSAPP 的 13.2 节。 &lt;a href=&quot;#fnref:3&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:4&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;https://stackoverflow.com/questions/14643249/why-having-to-use-non-blocking-fd-in-a-edge-triggered-epoll-function&quot;&gt;https://stackoverflow.com/questions/14643249/why-having-to-use-non-blocking-fd-in-a-edge-triggered-epoll-function&lt;/a&gt; &lt;a href=&quot;#fnref:4&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:5&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;https://books.google.com.sg/books?id=Ps2SH727eCIC&amp;amp;pg=PA1343&amp;amp;lpg=PA1343&amp;amp;dq=EPOLLRDHUP+edge+trigger&amp;amp;source=bl&amp;amp;ots=kMHdB9wVu3&amp;amp;sig=ACfU3U3NjhfO358eEjue0qzBxtjB-UK6Fw&amp;amp;hl=zh-CN&amp;amp;sa=X&amp;amp;ved=2ahUKEwii_cSBqajjAhVIOY8KHcImA044ChDoATADegQICRAB#v=onepage&amp;amp;q=EPOLLRDHUP edge trigger&amp;amp;f=false&quot;&gt;The Linux Programming Interface: A Linux and UNIX System Programming Handbook&lt;/a&gt; &lt;a href=&quot;#fnref:5&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:6&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;https://stackoverflow.com/questions/10681624/epollpri-when-does-this-case-happen&quot;&gt;https://stackoverflow.com/questions/10681624/epollpri-when-does-this-case-happen&lt;/a&gt; &lt;a href=&quot;#fnref:6&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:7&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;https://stackoverflow.com/questions/52976152/tcp-when-is-epollhup-generated&quot;&gt;https://stackoverflow.com/questions/52976152/tcp-when-is-epollhup-generated&lt;/a&gt; &lt;a href=&quot;#fnref:7&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:8&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;https://idea.popcount.org/2017-02-20-epoll-is-fundamentally-broken-12/&quot;&gt;https://idea.popcount.org/2017-02-20-epoll-is-fundamentally-broken-12/&lt;/a&gt; &lt;a href=&quot;#fnref:8&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt; &lt;a href=&quot;#fnref:8:1&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;sup&gt;2&lt;/sup&gt;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;</content>

      
      
      
      
      

      
        <author>
            <name>taoky</name>
          
          
        </author>
      

      
        <category term="tech" />
      

      
        <category term="epoll" />
      
        <category term="Linux" />
      

      
        <summary type="html">epoll 是 Linux 下的一种 I/O 事件通知机制1——这样写的话，总让人感觉不知所云。写这个主要是因为今年的 OSH 课程有一个写高性能静态页面的网页服务器的实验。epoll 作为一种提高性能的方式被不少人拿去用，虽然理解与写 epoll 代码并不是什么容易的事情，而且最后还是会有各种各样的问题。 https://en.wikipedia.org/wiki/Epoll &amp;#8617;</summary>
      

      
      
    </entry>
  
  
  
    <entry>
      
      <title type="html">水文 | 在 macOS 下配置虚拟机，安装其他操作系统</title>
      
      
      <link href="https://taoky.github.io/2019-02-23/installing-os-on-vm.html" rel="alternate" type="text/html" title="水文 | 在 macOS 下配置虚拟机，安装其他操作系统" />
      
      <published>2019-02-23T12:00:00+00:00</published>
      <updated>2019-02-23T12:00:00+00:00</updated>
      <id>https://taoky.github.io/2019-02-23/installing-os-on-vm</id>
      <content type="html" xml:base="https://taoky.github.io/2019-02-23/installing-os-on-vm.html">&lt;p&gt;感谢 @iBug 的邀稿。他的在 Windows/Linux 下设置 VMWare 虚拟机的教程在此（&lt;a href=&quot;https://ibugone.com/p/15&quot;&gt;English&lt;/a&gt;，&lt;a href=&quot;https://ibugone.com/p/15-cn&quot;&gt;中文&lt;/a&gt;）。&lt;/p&gt;

&lt;p&gt;主要目的是帮助使用 Mac 的同学简单配置虚拟机，以应对本学期的 操作系统原理与设计 课程（还有日常可能需要的 Windows 需求）。&lt;/p&gt;

&lt;h2 id=&quot;准备工作&quot;&gt;准备工作&lt;/h2&gt;

&lt;p&gt;需要以下内容：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;虚拟机软件。可以使用 Parallels Desktop, VMware Fusion 或 VirtualBox。其中前两者是商业、收费的软件，后者是免费开源的。以下将以后两者为例。&lt;/li&gt;
  &lt;li&gt;需要安装的操作系统的镜像文件，一般为 &lt;code class=&quot;highlighter-rouge&quot;&gt;*.iso&lt;/code&gt; 格式。
    &lt;ul&gt;
      &lt;li&gt;如果需要安装 Windows，镜像文件可以在一些网站找到，微软也会提供最新的 Windows 10 镜像的下载。&lt;/li&gt;
      &lt;li&gt;一般来说，大部分 Linux 发行版的镜像是很容易下载到的。如果遇到了网络障碍，可以至&lt;a href=&quot;https://mirrors.ustc.edu.cn/&quot;&gt;&lt;del&gt;肥科&lt;/del&gt;科大开源镜像站&lt;/a&gt;下载。&lt;/li&gt;
      &lt;li&gt;macOS 已经基本上 64 位化了，所以在下载时选择 32 位或 64 位均可。&lt;/li&gt;
      &lt;li&gt;以下将以 Ubuntu 18.04.2 64 位版本为例。该版本是 Ubuntu 最新的 LTS（长期支持版本）。&lt;/li&gt;
      &lt;li&gt;记得验证哈希。&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;足够的硬盘与内存空间。
    &lt;ul&gt;
      &lt;li&gt;根据需求的不同，可能需要几个 GiB 至几十个 GiB 的硬盘空间。&lt;/li&gt;
      &lt;li&gt;同样根据需求，建议分配 1～2 GiB 的内存。如果你的内存不大，建议在安装 Linux 时不选择重量级的图形界面（如 Unity, GNOME, KDE 等），或者选择不安装 GUI 的版本（如 Ubuntu Server）。&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;vmware-fusion-篇&quot;&gt;VMware Fusion 篇&lt;/h2&gt;

&lt;p&gt;由于法律原因，请自行下载、购买、激活此软件。对于较新版本的 macOS，在安装时需要在 系统偏好设置 =&amp;gt; 安全性与隐私中，同意内核驱动的安装。&lt;/p&gt;

&lt;h3 id=&quot;安装系统&quot;&gt;安装系统&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;/pictures/vm/vf_ui.png&quot; alt=&quot;The Interface of VMware Fusion&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;图 1 VMware Fusion 的界面。&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;由于使用了比较长的时间，我的虚拟机比较多。&lt;/p&gt;

&lt;p&gt;点按 + 号，新建虚拟机。将你的 &lt;code class=&quot;highlighter-rouge&quot;&gt;.iso&lt;/code&gt; 文件拖进去。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/pictures/vm/install-1.png&quot; alt=&quot;Installing Ubuntu - 1&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;图 2 开始安装&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/pictures/vm/install-2.png&quot; alt=&quot;Installing Ubuntu - 2&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;图 3 使用「快捷安装」配置&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;其实流程还是比较简单的。我们使用 VMware 提供的「快捷安装」功能。如果需要自己体验一下安装的感觉，可以参看下文的 VirtualBox 篇。&lt;/p&gt;

&lt;p&gt;点击「继续」，选择「自定设置」，以改变虚拟机设置信息。为虚拟机选择一个放置的目录，然后继续。&lt;/p&gt;

&lt;p&gt;接下来在开机之前，进行一些简单的配置。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/pictures/vm/install-3.png&quot; alt=&quot;Installing Ubuntu - 3&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;删除打印机、摄像头这种奇怪的设备，除非你需要。USB 与蓝牙、声卡也可以删掉。
    &lt;ul&gt;
      &lt;li&gt;软盘在安装结束后再删除。「快捷安装」需要软盘。&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;在硬盘处改变你需要分配的磁盘大小。在安装系统之后，硬盘空间可以增大，但不能减小。&lt;/li&gt;
  &lt;li&gt;在处理器和内存处改变分配 CPU 核心与内存大小。&lt;/li&gt;
  &lt;li&gt;在共享此处可以添加希望虚拟机能够访问到的宿主机（host）的文件夹。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;在一切办妥之后开机。静静等待「快捷安装」完成。&lt;/p&gt;

&lt;p&gt;（注：如果发现 Ubuntu 安装器很长时间卡在 Retrieving file 处，可以尝试断开一下网络。）&lt;/p&gt;

&lt;h3 id=&quot;有关虚拟机的配置&quot;&gt;有关虚拟机的配置&lt;/h3&gt;

&lt;p&gt;本文&lt;strong&gt;不会&lt;/strong&gt;介绍 Linux 的基本使用方法。仅就 Linux 配置中与虚拟机有关的内容进行介绍。&lt;/p&gt;

&lt;p&gt;一般来说，与 VMware 有关的工具在虚拟机中已经安装完成，如果没有，你可能需要手动安装 &lt;code class=&quot;highlighter-rouge&quot;&gt;open-vm-tools&lt;/code&gt;。该工具允许虚拟机与宿主机更好地互动：例如拖放、共享剪贴板、分辨率根据窗口大小变化等。&lt;/p&gt;

&lt;p&gt;如果发现 &lt;code class=&quot;highlighter-rouge&quot;&gt;open-vm-tools&lt;/code&gt; 出现了严重的问题且无法解决，可以尝试安装 VMware 附带的 VMware Tools，此处不再赘述。&lt;/p&gt;

&lt;p&gt;另外，如果需要连接 USB 设备，可能需要将 USB 兼容性设置为 USB 3.0。&lt;/p&gt;

&lt;h4 id=&quot;文件共享&quot;&gt;文件共享&lt;/h4&gt;

&lt;p&gt;在设置中选择共享文件夹后，共享的文件夹放置在 &lt;code class=&quot;highlighter-rouge&quot;&gt;/mnt/hgfs&lt;/code&gt; 下。如果没有，需要手动挂载。&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mount &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; fuse.vmhgfs-fuse .host:/ /mnt/hgfs &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; allow_other
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;需要以 root 用户权限执行。&lt;/p&gt;

&lt;h2 id=&quot;virtualbox-篇&quot;&gt;VirtualBox 篇&lt;/h2&gt;

&lt;p&gt;下载并安装，与 VMware 相似，也需要同意安装内核驱动。&lt;/p&gt;

&lt;p&gt;新建虚拟机，输入想给虚拟机起的名字以及放置位置，选择 Linux =&amp;gt; Ubuntu (64-bit)。之后选择分配的内存空间。&lt;/p&gt;

&lt;p&gt;创建虚拟磁盘，格式默认。建议选择「动态分配」（除非你硬盘非常大）。&lt;/p&gt;

&lt;p&gt;在启动之前，需要将镜像挂载到虚拟光驱。选择 设置 =&amp;gt; 存储 =&amp;gt; 没有盘片 处，在右边可以选择虚拟光驱文件。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/pictures/vm/vb-install-1.png&quot; alt=&quot;Installing Ubuntu By VirtualBox&quot; /&gt;&lt;/p&gt;

&lt;p&gt;另外，对于使用 Retina 屏幕（高分屏）的机器，建议缩放率调整到 200%，否则安装的时候界面很小，会比较尴尬。&lt;/p&gt;

&lt;p&gt;其他选项可以酌情调整，例如开启 3D 加速，增大内存等。&lt;/p&gt;

&lt;p&gt;启动之后选择语言（这里选择中文简体），选择安装 Ubuntu。之后按照安装器的提示即可。对于课程要求来说，建议「最小安装」，并且不要选择在安装时下载更新（在配置好软件源后再下载）。&lt;/p&gt;

&lt;p&gt;在分区处直接根据安装器的建议即可。这里清除的是虚拟机的虚拟磁盘，真实的磁盘不会受到影响。&lt;/p&gt;

&lt;p&gt;之后配置时区、用户等内容，等待安装结束。重启，按下回车键继续。&lt;/p&gt;

&lt;h3 id=&quot;有关虚拟机的配置-1&quot;&gt;有关虚拟机的配置&lt;/h3&gt;

&lt;p&gt;虚拟机需要安装 Guest Additions。在安装之前，需要先安装 &lt;code class=&quot;highlighter-rouge&quot;&gt;build-essential&lt;/code&gt; 软件包，以编译内核模块。&lt;/p&gt;

&lt;p&gt;选择 Devices =&amp;gt; Insert Guest Additions CD Image…，运行光盘中的软件。结束后重启。安装后，也可以支持拖放、剪贴板共享等。（不过，似乎有些功能还有点问题）&lt;/p&gt;

&lt;h4 id=&quot;文件共享-1&quot;&gt;文件共享&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;/pictures/vm/vb-configure.png&quot; alt=&quot;Configuring File Sharing&quot; /&gt;&lt;/p&gt;

&lt;p&gt;像这样配置文件共享后，Ubuntu 会自动挂载，但是可能会遇到权限问题。此时在终端中运行&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;adduser &lt;span class=&quot;nv&quot;&gt;$USER&lt;/span&gt; vboxsf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;将自己加入 &lt;code class=&quot;highlighter-rouge&quot;&gt;vboxsf&lt;/code&gt; 用户组。重启即可。默认目录会被挂载在 &lt;code class=&quot;highlighter-rouge&quot;&gt;/media&lt;/code&gt; 下。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/pictures/vm/vb-shared-folder.png&quot; alt=&quot;VirtualBox Shared Folder&quot; /&gt;&lt;/p&gt;</content>

      
      
      
      
      

      
        <author>
            <name>taoky</name>
          
          
        </author>
      

      

      
        <category term="虚拟机" />
      
        <category term="Linux" />
      
        <category term="macOS" />
      

      
        <summary type="html">感谢 @iBug 的邀稿。他的在 Windows/Linux 下设置 VMWare 虚拟机的教程在此（English，中文）。</summary>
      

      
      
    </entry>
  
  
  
    <entry>
      
      <title type="html">在 Docker for Mac 上使文件不可变（immutable）后容器无法删除的 workaround</title>
      
      
      <link href="https://taoky.github.io/2019-02-19/docker-for-mac-chattr-i-problem.html" rel="alternate" type="text/html" title="在 Docker for Mac 上使文件不可变（immutable）后容器无法删除的 workaround" />
      
      <published>2019-02-19T05:53:00+00:00</published>
      <updated>2019-02-19T05:53:00+00:00</updated>
      <id>https://taoky.github.io/2019-02-19/docker-for-mac-chattr-i-problem</id>
      <content type="html" xml:base="https://taoky.github.io/2019-02-19/docker-for-mac-chattr-i-problem.html">&lt;p&gt;昨天，学长 @zzh1996 发现在 Docker for Mac 的容器中对文件 &lt;code class=&quot;highlighter-rouge&quot;&gt;chattr +i&lt;/code&gt; 之后，容器就无法被正常删除。我在自己的电脑上复现了这个问题，并且，嗯，最后成功删掉了。在这里记录一下这个 workaround。&lt;/p&gt;

&lt;p&gt;（PS：Linux 上的 Docker 未见此问题）&lt;/p&gt;

&lt;h2 id=&quot;复现问题&quot;&gt;复现问题&lt;/h2&gt;

&lt;p&gt;版本：Docker Desktop 2.0.0.2 (30215)，Engine: 18.09.1&lt;/p&gt;

&lt;p&gt;跑一个 Ubuntu 的容器。设置 &lt;code class=&quot;highlighter-rouge&quot;&gt;--privileged=true&lt;/code&gt; 以使 &lt;code class=&quot;highlighter-rouge&quot;&gt;chattr +i&lt;/code&gt; 成功执行。&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;docker container run &lt;span class=&quot;nt&quot;&gt;--privileged&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-it&lt;/span&gt; ubuntu bash
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;创建 immutable 的文件。&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@1865cedf0ef0:/# &lt;span class=&quot;nb&quot;&gt;ls
&lt;/span&gt;bin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
root@1865cedf0ef0:/# &lt;span class=&quot;nb&quot;&gt;touch test
&lt;/span&gt;root@1865cedf0ef0:/# chattr +i &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;	&lt;span class=&quot;c&quot;&gt;# now `test` is immutable&lt;/span&gt;
root@1865cedf0ef0:/# &lt;span class=&quot;nb&quot;&gt;rm test&lt;/span&gt;	&lt;span class=&quot;c&quot;&gt;# cannot remove when you're root&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;rm&lt;/span&gt;: cannot remove &lt;span class=&quot;s1&quot;&gt;'test'&lt;/span&gt;: Operation not permitted
root@1865cedf0ef0:/# &lt;span class=&quot;nb&quot;&gt;rm&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;	&lt;span class=&quot;c&quot;&gt;# even `-f` won't work&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;rm&lt;/span&gt;: cannot remove &lt;span class=&quot;s1&quot;&gt;'test'&lt;/span&gt;: Operation not permitted
root@1865cedf0ef0:/# &lt;span class=&quot;nb&quot;&gt;exit&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;在退出之后看一下现有的容器。&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;base&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; ➜  ~ docker container &lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt;
CONTAINER ID        IMAGE                COMMAND                  CREATED             STATUS                      PORTS               NAMES
1865cedf0ef0        ubuntu               &lt;span class=&quot;s2&quot;&gt;&quot;bash&quot;&lt;/span&gt;                   2 minutes ago       Exited &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 2 minutes ago                        ecstatic_hawking
&lt;span class=&quot;c&quot;&gt;# 省略其他容器&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;然后……删不掉。&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;base&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; ➜  ~ docker container &lt;span class=&quot;nb&quot;&gt;rm &lt;/span&gt;186
Error response from daemon: container 1865cedf0ef0e58303a0361b8e19cd3a882a1bc741990603fb446e153656589f: driver &lt;span class=&quot;s2&quot;&gt;&quot;overlay2&quot;&lt;/span&gt; failed to remove root filesystem: remove /var/lib/docker/overlay2/e000b8a86824f48cb824ab643ce7d035e7ec4f3114bad897a2235cf922bba972/diff/test: operation not permitted
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;同样，加上 &lt;code class=&quot;highlighter-rouge&quot;&gt;-f&lt;/code&gt; 也没有任何作用。可以注意到，我们创建的文件阻止了容器的正常删除。&lt;/p&gt;

&lt;h2 id=&quot;workaround&quot;&gt;Workaround&lt;/h2&gt;

&lt;p&gt;那么，返回中指向的路径在哪里呢？很明显这不是我们主机上的路径。&lt;/p&gt;

&lt;p&gt;由 Docker 的工作原理我们知道，Docker for Mac 需要虚拟一个 Linux 内核才能够在 macOS 上正常运行，而这个最外层的虚拟机就是我们的目标：我们需要在其上把 &lt;code class=&quot;highlighter-rouge&quot;&gt;test&lt;/code&gt; 文件删掉。&lt;/p&gt;

&lt;p&gt;Docker for Mac 选择的虚拟机环境是 Xhyve VM。根据&lt;a href=&quot;https://forums.docker.com/t/is-it-possible-to-ssh-to-the-xhyve-machine/17426&quot;&gt;这条链接&lt;/a&gt;的内容，我们可以进入这个虚拟机环境。&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;screen ~/Library/Containers/com.docker.docker/Data/com.docker.driver.amd64-linux/tty
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;但是……&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;linuxkit-025000000001:/var/lib/docker/overlay2/e000b8a86824f48cb824ab643ce7d035e7ec4f3114bad897a2235cf922bba972/diff# &lt;span class=&quot;nb&quot;&gt;ls
test
&lt;/span&gt;linuxkit-025000000001:/var/lib/docker/overlay2/e000b8a86824f48cb824ab643ce7d035e7ec4f3114bad897a2235cf922bba972/diff# chattr
&lt;span class=&quot;nt&quot;&gt;-sh&lt;/span&gt;: chattr: not found
linuxkit-025000000001:/var/lib/docker/overlay2/e000b8a86824f48cb824ab643ce7d035e7ec4f3114bad897a2235cf922bba972/diff#
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;这个环境没有 &lt;code class=&quot;highlighter-rouge&quot;&gt;chattr&lt;/code&gt;……虽然有个包管理器 &lt;code class=&quot;highlighter-rouge&quot;&gt;apk&lt;/code&gt;，但是……&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;linuxkit-025000000001:/var/lib# apk update
ERROR: Unable to lock database: Read-only file system
ERROR: Failed to open apk database: Read-only file system
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;外层虚拟机的系统部分是只读的，装不了什么东西。虽然缺 &lt;code class=&quot;highlighter-rouge&quot;&gt;chattr&lt;/code&gt;，但是一些基础的东西还是比较齐的——甚至有 &lt;code class=&quot;highlighter-rouge&quot;&gt;wget&lt;/code&gt;。如果去运行的话会发现这些工具都来自于 BusyBox。但是，BusyBox 里面应该是有 &lt;code class=&quot;highlighter-rouge&quot;&gt;chattr&lt;/code&gt; 的啊&lt;sup id=&quot;fnref:1&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;。&lt;/p&gt;

&lt;p&gt;这就尴尬了。&lt;/p&gt;

&lt;p&gt;所幸的是，在 BusyBox 的网站上可以直接下载到编译好的二进制文件。&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;wget https://busybox.net/downloads/binaries/1.30.0-i686/busybox_CHATTR
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;然后，&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;linuxkit-025000000001:/var/lib/docker/overlay2/e000b8a86824f48cb824ab643ce7d035e7ec4f3114bad897a2235cf922bba972/diff# &lt;span class=&quot;nb&quot;&gt;chmod&lt;/span&gt; +x ./busybox_CHATTR
linuxkit-025000000001:/var/lib/docker/overlay2/e000b8a86824f48cb824ab643ce7d035e7ec4f3114bad897a2235cf922bba972/diff# ./busybox_CHATTR &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;test
&lt;/span&gt;linuxkit-025000000001:/var/lib/docker/overlay2/e000b8a86824f48cb824ab643ce7d035e7ec4f3114bad897a2235cf922bba972/diff# &lt;span class=&quot;nb&quot;&gt;rm test&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;之后退出虚拟机环境，再删一次就行了。&lt;/p&gt;

&lt;h2 id=&quot;附录-1-能不能直接从其他-linux-机器上复制一份-chattr-过来&quot;&gt;附录 1: 能不能直接从其他 Linux 机器上复制一份 &lt;code class=&quot;highlighter-rouge&quot;&gt;chattr&lt;/code&gt; 过来？&lt;/h2&gt;

&lt;p&gt;答案是：（大部分情况下）不行。&lt;/p&gt;

&lt;p&gt;实话讲，这是我想到的第一个办法。但最终证明是行不通的。为什么？动态链接。&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@tao-kali:~# &lt;span class=&quot;nb&quot;&gt;uname&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt;
Linux tao-kali 4.19.0-kali1-amd64 &lt;span class=&quot;c&quot;&gt;#1 SMP Debian 4.19.13-1kali1 (2019-01-03) x86_64 GNU/Linux&lt;/span&gt;
root@tao-kali:~# ldd /usr/bin/chattr
	linux-vdso.so.1 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0x00007ffe607c1000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
	libe2p.so.2 &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; /lib/x86_64-linux-gnu/libe2p.so.2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0x00007ff779d4e000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
	libcom_err.so.2 &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; /lib/x86_64-linux-gnu/libcom_err.so.2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0x00007ff779d48000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
	libblkid.so.1 &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; /lib/x86_64-linux-gnu/libblkid.so.1 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0x00007ff779cf3000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
	libc.so.6 &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; /lib/x86_64-linux-gnu/libc.so.6 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0x00007ff779b32000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
	libpthread.so.0 &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; /lib/x86_64-linux-gnu/libpthread.so.0 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0x00007ff779b11000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
	/lib64/ld-linux-x86-64.so.2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0x00007ff779d86000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
	libuuid.so.1 &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; /lib/x86_64-linux-gnu/libuuid.so.1 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0x00007ff779b08000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;可以注意到，这份 &lt;code class=&quot;highlighter-rouge&quot;&gt;chattr&lt;/code&gt; 依赖于 7 个动态链接库。而这个精简的虚拟环境很难满足这些需求。&lt;/p&gt;

&lt;p&gt;而下载得到的 &lt;code class=&quot;highlighter-rouge&quot;&gt;chattr&lt;/code&gt; 是静态链接的。&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;base&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; ➜  Downloads file busybox_CHATTR
busybox_CHATTR: ELF 32-bit LSB executable, Intel 80386, version 1 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;SYSV&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, statically linked, stripped
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;所以说……用于 rescue 的程序最好还是静态链接。&lt;/p&gt;

&lt;h2 id=&quot;附录-2-chattr-i-到底做了什么&quot;&gt;附录 2: &lt;code class=&quot;highlighter-rouge&quot;&gt;chattr +i&lt;/code&gt; 到底做了什么？&lt;/h2&gt;

&lt;p&gt;简单地说，”immutable” 等实际是文件系统提供的一种特性。所以要对不支持此特性的文件系统（比如 FAT32）上的文件运行 &lt;code class=&quot;highlighter-rouge&quot;&gt;chattr&lt;/code&gt; 是行不通的。&lt;/p&gt;

&lt;p&gt;从 BusyBox 的源码中可以找到 &lt;code class=&quot;highlighter-rouge&quot;&gt;chattr.c&lt;/code&gt;，该文件属于 &lt;code class=&quot;highlighter-rouge&quot;&gt;e2fsprogs&lt;/code&gt;。分析代码可以发现在解码完参数之后，调用了宏 &lt;code class=&quot;highlighter-rouge&quot;&gt;fsetflags(name, flags)&lt;/code&gt;（实际指向函数 &lt;code class=&quot;highlighter-rouge&quot;&gt;fgetsetflags(name, NULL, flags)&lt;/code&gt;），通过 &lt;code class=&quot;highlighter-rouge&quot;&gt;ioctl&lt;/code&gt; 对文件的 &lt;code class=&quot;highlighter-rouge&quot;&gt;flags&lt;/code&gt; 进行了修改。&lt;/p&gt;

&lt;p&gt;目前，Docker 使用 OverlayFS 文件系统。它是一种 union filesystem，可以让不同文件系统的文件挂载在同一个挂载点上。Docker 以这种方式实现分层镜像&lt;sup id=&quot;fnref:2&quot;&gt;&lt;a href=&quot;#fn:2&quot; class=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt;。而在虚拟环境中 &lt;code class=&quot;highlighter-rouge&quot;&gt;df -hT&lt;/code&gt; 可以看到，&lt;code class=&quot;highlighter-rouge&quot;&gt;/dev/sda1&lt;/code&gt;（虚拟磁盘）是以 &lt;code class=&quot;highlighter-rouge&quot;&gt;ext4&lt;/code&gt; 挂在 &lt;code class=&quot;highlighter-rouge&quot;&gt;/var/lib&lt;/code&gt; 上的。&lt;/p&gt;

&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;https://busybox.net/downloads/BusyBox.html&quot;&gt;https://busybox.net/downloads/BusyBox.html&lt;/a&gt; &lt;a href=&quot;#fnref:1&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;https://medium.com/@paccattam/drooling-over-docker-2-understanding-union-file-systems-2e9bf204177c&quot;&gt;https://medium.com/@paccattam/drooling-over-docker-2-understanding-union-file-systems-2e9bf204177c&lt;/a&gt; &lt;a href=&quot;#fnref:2&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;</content>

      
      
      
      
      

      
        <author>
            <name>taoky</name>
          
          
        </author>
      

      

      
        <category term="Docker" />
      
        <category term="Mac" />
      
        <category term="Troubleshoot" />
      

      
        <summary type="html">昨天，学长 @zzh1996 发现在 Docker for Mac 的容器中对文件 chattr +i 之后，容器就无法被正常删除。我在自己的电脑上复现了这个问题，并且，嗯，最后成功删掉了。在这里记录一下这个 workaround。</summary>
      

      
      
    </entry>
  
  
  
    <entry>
      
      <title type="html">在 iOS 设备上编译原生 lc3tools</title>
      
      
      <link href="https://taoky.github.io/2019-02-12/compiling-lc3tools-on-ios-device.html" rel="alternate" type="text/html" title="在 iOS 设备上编译原生 lc3tools" />
      
      <published>2019-02-12T12:01:00+00:00</published>
      <updated>2019-02-12T12:01:00+00:00</updated>
      <id>https://taoky.github.io/2019-02-12/compiling-lc3tools-on-ios-device</id>
      <content type="html" xml:base="https://taoky.github.io/2019-02-12/compiling-lc3tools-on-ios-device.html">&lt;p&gt;这次寒假回家的时候，给已经慢得要死的 iPad mini 降级到了 iOS 8.4.1，然后用 &lt;a href=&quot;https://coolbooter.com/&quot;&gt;CoolBooter&lt;/a&gt; 装上了 iOS 6.1.3（因为 iOS 8 还是很慢）——反正设备里面已经没有任何有用的数据了，怎么搞都可以。既然如此，在安装上 OpenSSH 之后就可以 &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt; 到我们的设备上搞事啦。&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;base&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; ➜  ~ ssh root@192.168.0.109
root@192.168.0.109&lt;span class=&quot;s1&quot;&gt;'s password: # password is '&lt;/span&gt;alpine&lt;span class=&quot;s1&quot;&gt;' by default
Kud:~ root# uname -a
Darwin Kud 13.0.0 Darwin Kernel Version 13.0.0: Wed Feb 13 21:37:47 PST 2013; root:xnu-2107.7.55.2.2~1/RELEASE_ARM_S5L8942X iPad2,5 arm P105AP Darwin
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;但是系统内置的命令很少，基本干不了什么事情（当然要想 &lt;code class=&quot;highlighter-rouge&quot;&gt;rm -rf /&lt;/code&gt; 删光文件跑路还是可以的）。我们知道，Cydia 实际上是使用的 Debian 的那一套来管理软件包的，但是找不到 &lt;code class=&quot;highlighter-rouge&quot;&gt;apt-get&lt;/code&gt;——所以我们在 Cydia 中安装 &lt;code class=&quot;highlighter-rouge&quot;&gt;APT 0.6 Transitional&lt;/code&gt; 或者 &lt;code class=&quot;highlighter-rouge&quot;&gt;APT 0.7 Strict&lt;/code&gt;&lt;sup id=&quot;fnref:1&quot;&gt;&lt;a href=&quot;#fn:1&quot; class=&quot;footnote&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;，然后就可以抛弃掉这个缓慢的前端界面了。&lt;/p&gt;

&lt;p&gt;默认的 APT 源（在 &lt;code class=&quot;highlighter-rouge&quot;&gt;/etc/apt/sources.list.d/&lt;/code&gt; 里面）的命令行工具比我原先想象的要多不少。要是能够装个编译器来编译我们自己写的程序就好了。&lt;/p&gt;

&lt;p&gt;当然，这是可以做到的。至于为什么选择 &lt;code class=&quot;highlighter-rouge&quot;&gt;lc3tools&lt;/code&gt; 作为我们的目标？那是因为这个程序足够小，同时舍友 @iBug 也成功在 Android 上编译了这个工具。&lt;/p&gt;

&lt;p&gt;有什么用吗？emmmmmm，&lt;strong&gt;其实没什么用&lt;/strong&gt;，至少我相信不会有人去拿这玩意去完成自己的 ICS 作业。&lt;/p&gt;

&lt;h2 id=&quot;准备工具链&quot;&gt;准备工具链&lt;/h2&gt;

&lt;p&gt;默认源里可以找到 &lt;code class=&quot;highlighter-rouge&quot;&gt;gcc&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;clang&lt;/code&gt;。&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Kud:~ root# apt-cache search gcc
iphone-gcc - a native c compiler _on_ the phone
com.macciti.sliderkoenigseggccxorange - Nice Slider of a orange Koenigsegg CCX. If you want your Car as a Slider on your iPhone, email me! I will make Sliders of all your Cars!! &lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
com.bigboss.20toolchain - Full &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;compatibility&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; toolchain with one click! Use this to compile your 1.1.x apps &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;2.0 with some limitations. BigBoss&lt;span class=&quot;s1&quot;&gt;' headers for 1.1.1 from working Cygwin toolchain. Also depends on all other necessary packages. Copies to /var/include and symlinks /usr/local/include to /var/include if possible. Also links gcc to arm-apple-darwin-gcc.
# 以下省略
Kud:~ root# apt-cache search clang
org.coolstar.iostoolchain - LLVM+Clang, ld64, CC tools, Make, ldid
org.coolstar.llvm-clang - LLVM, Clang, and Compiler for 32/64Bit devices
org.coolstar.llvm-clang32 - LLVM, Clang, and Compiler-RT 3.4 SVN
org.coolstar.llvm-clang64 - LLVM, Clang, and LLD 5.0.1 for iOS/arm64
# 以下省略
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;但如果你去尝试安装 &lt;code class=&quot;highlighter-rouge&quot;&gt;gcc&lt;/code&gt;，会发现缺少 &lt;code class=&quot;highlighter-rouge&quot;&gt;libgcc&lt;/code&gt; 的依赖。所以还是去安装 &lt;code class=&quot;highlighter-rouge&quot;&gt;org.coolstar.iostoolchain&lt;/code&gt; 吧（据说&lt;sup id=&quot;fnref:2&quot;&gt;&lt;a href=&quot;#fn:2&quot; class=&quot;footnote&quot;&gt;2&lt;/a&gt;&lt;/sup&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;gcc&lt;/code&gt; 的版本比 &lt;code class=&quot;highlighter-rouge&quot;&gt;LLVM+Clang&lt;/code&gt; 工具链要老得多）。&lt;/p&gt;

&lt;p&gt;好，安装完这一套工具链，写个 Hello, world! 编译看看。&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Kud:~ root# &lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;helloworld.c
&lt;span class=&quot;c&quot;&gt;#include &amp;lt;stdio.h&amp;gt;&lt;/span&gt;

int main&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;void&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Hello, world!&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return &lt;/span&gt;0&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
Kud:~ root# clang helloworld.c
helloworld.c:1:10: fatal error: &lt;span class=&quot;s1&quot;&gt;'stdio.h'&lt;/span&gt; file not found
&lt;span class=&quot;c&quot;&gt;#include &amp;lt;stdio.h&amp;gt;&lt;/span&gt;
         ^
1 error generated.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;最后你会绝望得发现，就算去掉 &lt;code class=&quot;highlighter-rouge&quot;&gt;include&lt;/code&gt;，自己动手声明函数，也会在链接的时候遇到问题。&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Kud:~ root# &lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;test.c
int &lt;span class=&quot;nb&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;const char &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; restrict format, ...&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

int main&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;void&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Hello, world!&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return &lt;/span&gt;0&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
Kud:~ root# clang test.c
ld: library not found &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-lcrt1&lt;/span&gt;.3.1.o
clang-3.7: error: linker &lt;span class=&quot;nb&quot;&gt;command &lt;/span&gt;failed with &lt;span class=&quot;nb&quot;&gt;exit &lt;/span&gt;code 1 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;use &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; to see invocation&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;关于-sdk&quot;&gt;关于 SDK&lt;/h2&gt;

&lt;p&gt;为了解决这个问题，我们需要 iOS 对应的 SDK。在下载&lt;sup id=&quot;fnref:3&quot;&gt;&lt;a href=&quot;#fn:3&quot; class=&quot;footnote&quot;&gt;3&lt;/a&gt;&lt;/sup&gt;对应版本的 SDK 之后，我们可以看看里面有什么东西。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/pictures/ios-compile/sdk.png&quot; alt=&quot;The structure of iOS SDK&quot; /&gt;&lt;/p&gt;

&lt;p&gt;我们看到了熟悉的 &lt;code class=&quot;highlighter-rouge&quot;&gt;usr/lib&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;usr/include&lt;/code&gt;。&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;base&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; ➜  iPhoneOS6.1.sdk &lt;span class=&quot;nb&quot;&gt;ls &lt;/span&gt;usr/include/stdio.h 
usr/include/stdio.h
&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;base&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; ➜  iPhoneOS6.1.sdk &lt;span class=&quot;nb&quot;&gt;ls &lt;/span&gt;usr/lib/crt1.3.1.o 
usr/lib/crt1.3.1.o
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;缺少的文件都在这里。&lt;/p&gt;

&lt;p&gt;可以理解为什么 iOS 不自带这些文件，作为移动端的操作系统，头文件和运行库的目标文件对于终端用户而言没有任何意义。&lt;/p&gt;

&lt;p&gt;用 &lt;code class=&quot;highlighter-rouge&quot;&gt;scp&lt;/code&gt; 传过去，然后怎么让 &lt;code class=&quot;highlighter-rouge&quot;&gt;clang&lt;/code&gt; 知道 SDK 的位置呢？&lt;code class=&quot;highlighter-rouge&quot;&gt;clang&lt;/code&gt; 有一个参数 &lt;code class=&quot;highlighter-rouge&quot;&gt;-isysroot&lt;/code&gt;，可以指定系统根目录的位置。正常情况下，这个目录就是 &lt;code class=&quot;highlighter-rouge&quot;&gt;/&lt;/code&gt;，但是很明显 &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/&lt;/code&gt; 下面没有我们想要的东西。&lt;/p&gt;

&lt;p&gt;所以我们来试一下：&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Kud:~ root# clang helloworld.c &lt;span class=&quot;nt&quot;&gt;-isysroot&lt;/span&gt; ~/sdk &lt;span class=&quot;c&quot;&gt;# ~/sdk is where you store your iOS SDK&lt;/span&gt;
Kud:~ root# ./a.out
Hello, world!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;可以了。&lt;/p&gt;

&lt;p&gt;如果手头有一台 Linux 机器，那么也可以看到类似于 &lt;code class=&quot;highlighter-rouge&quot;&gt;crt1.3.1.o&lt;/code&gt; 的文件。&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;taoky@linux-cloud:/usr/lib/x86_64-linux-gnu&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;.o &lt;span class=&quot;c&quot;&gt;# on a Ubuntu 18.04.2 machine&lt;/span&gt;
Mcrt1.o  crt1.o  crtn.o   grcrt1.o           rcrt1.o
Scrt1.o  crti.o  gcrt1.o  libtsan_preinit.o
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;crt&lt;/code&gt; 是 C Runtime 的缩写。我们知道 Linux 一般而言 C 运行库是 &lt;code class=&quot;highlighter-rouge&quot;&gt;glibc&lt;/code&gt;，那么 macOS/iOS 下是什么？&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Kud:~ root# otool &lt;span class=&quot;nt&quot;&gt;-L&lt;/span&gt; a.out
a.out:
	/usr/lib/libSystem.B.dylib &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;compatibility version 1.0.0, current version 173.8.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;dylib&lt;/code&gt; 格式是 macOS/iOS 的动态库格式，类似于 Linux 下的 &lt;code class=&quot;highlighter-rouge&quot;&gt;*.so&lt;/code&gt;。而 &lt;code class=&quot;highlighter-rouge&quot;&gt;libSystem&lt;/code&gt; 库提供了 &lt;code class=&quot;highlighter-rouge&quot;&gt;libc&lt;/code&gt; 的功能&lt;sup id=&quot;fnref:4&quot;&gt;&lt;a href=&quot;#fn:4&quot; class=&quot;footnote&quot;&gt;4&lt;/a&gt;&lt;/sup&gt;。&lt;/p&gt;

&lt;h2 id=&quot;开始编译&quot;&gt;开始编译&lt;/h2&gt;

&lt;p&gt;下载一份 &lt;code class=&quot;highlighter-rouge&quot;&gt;lc3tools&lt;/code&gt; 源代码，丢过去。（这里的 OpenSSL 版本太老了，连 GitHub 都连不上，所以只能电脑上下载好之后传过去）&lt;/p&gt;

&lt;p&gt;在 &lt;code class=&quot;highlighter-rouge&quot;&gt;./configure&lt;/code&gt; 中缺失的 &lt;code class=&quot;highlighter-rouge&quot;&gt;flex&lt;/code&gt; 依赖（用于汇编器的词法分析）可以在源里找到。但 &lt;code class=&quot;highlighter-rouge&quot;&gt;wish&lt;/code&gt; 是什么？&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;wish&lt;/code&gt; 是 Tcl/Tk 的解释器，可以用来创建 GUI 界面。显然我们这里不需要 GUI（也显示不了），所以可以直接删掉。&lt;/p&gt;

&lt;p&gt;另外会报告找不到 &lt;code class=&quot;highlighter-rouge&quot;&gt;gcc&lt;/code&gt;，一个简单粗暴的解决方法是创建软链接。&lt;/p&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Kud:~/lc3tools root# &lt;span class=&quot;nb&quot;&gt;ln&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt; /usr/bin/clang /usr/bin/gcc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;由于我们先前提到的原因，我们还要修改 &lt;code class=&quot;highlighter-rouge&quot;&gt;Makefile.def&lt;/code&gt;，以使 &lt;code class=&quot;highlighter-rouge&quot;&gt;configure&lt;/code&gt; 生成正确的 &lt;code class=&quot;highlighter-rouge&quot;&gt;Makefile&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;将&lt;/p&gt;

&lt;div class=&quot;language-makefile highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;CFLAGS&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-g&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-Wall&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# 编译时选项&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;LDFLAGS&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-g&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# 链接时选项&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;修改为&lt;/p&gt;

&lt;div class=&quot;language-makefile highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;CFLAGS&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-g&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-Wall&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-isysroot&lt;/span&gt; ~/sdk
&lt;span class=&quot;nv&quot;&gt;LDFLAGS&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-g&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-isysroot&lt;/span&gt; ~/sdk
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;再运行 &lt;code class=&quot;highlighter-rouge&quot;&gt;./configure&lt;/code&gt;，之后就可以顺利编译了。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/pictures/ios-compile/success.png&quot; alt=&quot;Success&quot; /&gt;&lt;/p&gt;

&lt;p&gt;成功～&lt;/p&gt;

&lt;div class=&quot;footnotes&quot;&gt;
  &lt;ol&gt;
    &lt;li id=&quot;fn:1&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;https://www.reddit.com/r/jailbreak/comments/3dpzkj/tutorial_fun_with_aptcache_and_aptget_install_apt/&quot;&gt;https://www.reddit.com/r/jailbreak/comments/3dpzkj/tutorial_fun_with_aptcache_and_aptget_install_apt/&lt;/a&gt; &lt;a href=&quot;#fnref:1&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:2&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;http://iphonedevwiki.net/index.php/On-device_toolchains&quot;&gt;http://iphonedevwiki.net/index.php/On-device_toolchains&lt;/a&gt; &lt;a href=&quot;#fnref:2&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:3&quot;&gt;
      &lt;p&gt;见 &lt;a href=&quot;http://resources.airnativeextensions.com/ios/&quot;&gt;http://resources.airnativeextensions.com/ios/&lt;/a&gt;，&lt;a href=&quot;https://github.com/theos/sdks&quot;&gt;https://github.com/theos/sdks&lt;/a&gt; 上也有几个不同的版本。 &lt;a href=&quot;#fnref:3&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
    &lt;li id=&quot;fn:4&quot;&gt;
      &lt;p&gt;&lt;a href=&quot;https://www.oreilly.com/library/view/mac-os-x/0596003560/ch05s02.html&quot;&gt;https://www.oreilly.com/library/view/mac-os-x/0596003560/ch05s02.html&lt;/a&gt; &lt;a href=&quot;#fnref:4&quot; class=&quot;reversefootnote&quot;&gt;&amp;#8617;&lt;/a&gt;&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/div&gt;</content>

      
      
      
      
      

      
        <author>
            <name>taoky</name>
          
          
        </author>
      

      

      
        <category term="iOS" />
      
        <category term="jailbreak" />
      
        <category term="编译" />
      

      
        <summary type="html">这次寒假回家的时候，给已经慢得要死的 iPad mini 降级到了 iOS 8.4.1，然后用 CoolBooter 装上了 iOS 6.1.3（因为 iOS 8 还是很慢）——反正设备里面已经没有任何有用的数据了，怎么搞都可以。既然如此，在安装上 OpenSSH 之后就可以 ssh 到我们的设备上搞事啦。</summary>
      

      
      
    </entry>
  
  
  
    <entry>
      
      <title type="html">重新迁移：回到 Jekyll</title>
      
      
      <link href="https://taoky.github.io/2019-02-12/migration-to-jekyll-again.html" rel="alternate" type="text/html" title="重新迁移：回到 Jekyll" />
      
      <published>2019-02-12T09:17:00+00:00</published>
      <updated>2019-02-12T09:17:00+00:00</updated>
      <id>https://taoky.github.io/2019-02-12/migration-to-jekyll-again</id>
      <content type="html" xml:base="https://taoky.github.io/2019-02-12/migration-to-jekyll-again.html">&lt;p&gt;再次迁移回了 Jekyll。&lt;/p&gt;

&lt;p&gt;从 Hexo 迁移回去的很大一个原因是 &lt;code class=&quot;highlighter-rouge&quot;&gt;npm&lt;/code&gt; 给人带来的无力感：我只想简简单单做一件事情，但是 &lt;code class=&quot;highlighter-rouge&quot;&gt;npm&lt;/code&gt; 给我带来了无穷无尽的依赖，还有 GitHub 时不时给我发送的安全警告。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/pictures/migration/1.png&quot; alt=&quot;Security Alert by GitHub&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;啊……&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Hexo 的 &lt;a href=&quot;https://github.com/theme-next/hexo-theme-next&quot;&gt;NexT 主题&lt;/a&gt; 确实很漂亮，但是实话讲有点审美疲劳了吧（尤其是看到有一大帮人用了之后）。原来的评论系统使用的是 &lt;a href=&quot;https://github.com/imsun/gitment&quot;&gt;Gitment&lt;/a&gt;——把 GitHub Issues 搞成评论确实是一个很新奇的主意，但是看到 repo 的 issues 里面一堆让我感到有点尴尬，而且一个更现实的问题是：根本没人评论啊。&lt;/p&gt;

&lt;p&gt;花了一点时间，重新搞回来了，没有遇到太糟糕的问题，顺便为了用各种 plugins，搞了 CI 部署 GitHub Pages，感谢 @iBug 提供的示例脚本。&lt;/p&gt;</content>

      
      
      
      
      

      
        <author>
            <name>taoky</name>
          
          
        </author>
      

      

      
        <category term="Jekyll" />
      
        <category term="Hexo" />
      

      
        <summary type="html">再次迁移回了 Jekyll。</summary>
      

      
      
    </entry>
  
  
  
    <entry>
      
      <title type="html">瞎写的大一一年总结</title>
      
      
      <link href="https://taoky.github.io/2018-08-29/freshman-year.html" rel="alternate" type="text/html" title="瞎写的大一一年总结" />
      
      <published>2018-08-29T16:36:12+00:00</published>
      <updated>2018-08-29T16:36:12+00:00</updated>
      <id>https://taoky.github.io/2018-08-29/freshman-year</id>
      <content type="html" xml:base="https://taoky.github.io/2018-08-29/freshman-year.html">&lt;p&gt;我主博客的文章太少了，所以打算在假期的最后加一篇。以后打算再多写点技术类的东西，毕竟把这里完全作为个人生活的记录处不像是 GitHub Pages 的正确用法啊😂，作为一个 CS 系的同学，不写点跟这有关的东西好像对不起自己啊，虽然怕是一开学，就没有时间可以给我写东西了。另外，我又开了一个 repo，记录我自己的艺术与娱乐作品点评。链接这里就不放了，不过只要稍微找一找就能轻松找到的。&lt;/p&gt;

&lt;!--more--&gt;

&lt;p&gt;下面的都是瞎写写出来的，写到后来我自己也不知道在写什么就是了。&lt;/p&gt;

&lt;h2 id=&quot;01&quot;&gt;01&lt;/h2&gt;

&lt;p&gt;大一一进来的课表比我想象得松，但到大一下课表就紧实了不少。到搬到中区之后，每天西区和中区往返，就是不少的运动量。&lt;/p&gt;

&lt;p&gt;大概大一上的时候考虑的是保守主义，所以公选只搞了一门看起来非常简单的 MOOC——当然实际上，也确实非常简单。剩下来就是翻阅评课社区，看看有没有什么巨坑可以避开的。&lt;/p&gt;

&lt;p&gt;体验其实还是可以的，虽然一开始专业类的课程没有（我想象得）那么多，西区也确实寒碜了点。现在想来，大一上简直就是轻松愉快（除了大作业集中的一两个星期之外）。高级班的英语只在大一上有课，体验也不错。&lt;/p&gt;

&lt;p&gt;到了大一下，为了凑满公选学分，选了桥牌和另一门 MOOC，这两门课的压力也不怎么大，虽然我桥牌到后面都是凭感觉来打的，最后一堂课的考试有一点头疼。至于别的课，代数结构到第二章数论的时候就感觉头疼，高中时候没学过数论的我当时睁眼抓瞎，不过还好数论对后面群环域的部分关系不是非常紧密，还有与我想象中完全不一样的电磁学——这两门占用了我大半的作业时间。&lt;/p&gt;

&lt;p&gt;当然还有「科大特产」：大物实验。有一张图片很有名，可以用来描述一名普通的学生面对大物实验时的心理变化：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/pictures/freshman/cpe.png&quot; alt=&quot;「大物实验我*你娘」&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;图一。来源：&lt;a href=&quot;https://www.zhihu.com/question/35867101/answer/150074112&quot;&gt;如何评价中科大开设的大物实验课？ - 知乎&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;大物实验一开始可折腾得不轻。不过做了几次实验之后，轻车熟路，&lt;del&gt;在张力等学长的帮助下&lt;/del&gt;，实验都还算顺利，有几次有惊无险吧。&lt;/p&gt;

&lt;p&gt;程序设计的话，对我来说没什么，两个学期都选的 mjh 的课。不过我要吹爆 mjh 班下半学期的实验。就是应该多一点，然后让大家自己搜索资料学习啊。隔壁班连个算分的大作业都没有。作为一个追求全平台的人，写图形界面用过了 PyQt 和 Electron。&lt;/p&gt;

&lt;p&gt;至于物理的话，科大特色嘛。我一位高中同学，现在在南大计算机系，吐槽说我们怎么这么多物理课，就算是计拔也只要学大学物理啊。物理课到下学期就结束了，再忍忍吧。&lt;/p&gt;

&lt;p&gt;哦还有到快开学才出分的新生研讨课。为什么我要提它呢？因为和同学一起做项目写代码写着开心啊～&lt;/p&gt;

&lt;h2 id=&quot;02&quot;&gt;02&lt;/h2&gt;

&lt;p&gt;科大有很多不错的地方，也有很多糟糕的地方。具体不列举，因为没那个精力去想。&lt;/p&gt;

&lt;p&gt;不过，来到科大最棒的一件事情就是加入 LUG 啦！如果科大没有 LUG，我现在就很有可能在南大了😂。&lt;/p&gt;

&lt;p&gt;认识了很多很不错的人，也认识了更多有趣的东西。&lt;/p&gt;

&lt;p&gt;另一个社团是爱乐社，我报名想去参加写代码的工作，结果被分到了设计，而且一整个学期啥都没干……最后也自己退出来了吧就是……&lt;/p&gt;

&lt;h2 id=&quot;03&quot;&gt;03&lt;/h2&gt;

&lt;p&gt;大学生活的第一年，感觉还是可以的。&lt;/p&gt;

&lt;!--

5pyJ5Lqb6K+d5YaZ5Zyo6L+Z6YeM77yM5Zug5Li644CM5p+Q5L2N44CN44CM566h55CG5Lq65ZGY44CN5piv55yL5LiN5Yiw6L+Z6YeM55qE44CCCgrorqHnrpfmnLrns7vlpKfkuIDkuI3og73luKbnlLXohJHvvJ/ov5nlsLHmmK/lpJbooYzpooblr7zlhoXooYzlvI/nmoTlvLHmmbrlhrPnrZbvvIHmiJHlsLHluKbkuobvvIzogIzkuJTmiJHlpb3lpb3nmoTjgIIKCuS9oOesrOS4gOasoeW9k+ePreS4u+S7u++8n+aIkei/mOesrOS4gOasoeW9k+Wkp+WtpueUn+WRou+8gQoK5L2g6YKj5LmI5Zac5qyi5by65Yi26Ieq5Lmg77yf6KaB5piv5aSn5LqM5YaN6L+Z5LmI5pCe5oiR6KaB55So5LiA5YiH6IO955So55qE5omL5q615ouS57ud44CCCgrov5jmnInnnaHmh5Lop4nlkovkuobvvJ/lkajmnKvkvJHmga/kuIDkuIvpg73kuI3ooYzvvJ8KCg==

--&gt;

&lt;p&gt;宿舍还行吧，有兴趣相似的人。学校外的话就只吃过饭，没什么其他的娱乐活动。不过感谢大物实验，我开始看动画了。啥？玩游戏？你到大一下学期还有时间玩游戏？谈恋爱？你觉得科大这个男女比例可能吗？&lt;/p&gt;

&lt;h2 id=&quot;04&quot;&gt;04&lt;/h2&gt;

&lt;p&gt;&lt;del&gt;没有未来的未来不是我想要的未来&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;加入了校 CTF 战队，但我其实没有特别想往安全方向走的打算。之所以加入，是因为一开始感觉自己之前知道的，「看起来没有什么卵用」的东西，竟然真的能在这里「有点卵用」。和大家一起比赛也很开心，&lt;del&gt;虽然很累，20 号比赛完之后我直接躺床上睡着了&lt;/del&gt;。&lt;/p&gt;

&lt;p&gt;别的类型的比赛可能也会参加吧，只是可能真的再也分不出多少精力了吧。&lt;/p&gt;

&lt;p&gt;以后的话，大概方向就是 专业知识 + 英语口语的样子吧，再在 GitHub 上吸引一些小星星吧😂。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;EOF&lt;/p&gt;</content>

      
      
      
      
      

      
        <author>
            <name>taoky</name>
          
          
        </author>
      

      
        <category term="总结" />
      

      
        <category term="总结" />
      
        <category term="大一" />
      

      
        <summary type="html">我主博客的文章太少了，所以打算在假期的最后加一篇。以后打算再多写点技术类的东西，毕竟把这里完全作为个人生活的记录处不像是 GitHub Pages 的正确用法啊😂，作为一个 CS 系的同学，不写点跟这有关的东西好像对不起自己啊，虽然怕是一开学，就没有时间可以给我写东西了。另外，我又开了一个 repo，记录我自己的艺术与娱乐作品点评。链接这里就不放了，不过只要稍微找一找就能轻松找到的。</summary>
      

      
      
    </entry>
  
  
  
    <entry>
      
      <title type="html">语言学家</title>
      
      
      <link href="https://taoky.github.io/2018-07-14/language-gaokao-composition.html" rel="alternate" type="text/html" title="语言学家" />
      
      <published>2018-07-14T10:09:29+00:00</published>
      <updated>2018-07-14T10:09:29+00:00</updated>
      <id>https://taoky.github.io/2018-07-14/language-gaokao-composition</id>
      <content type="html" xml:base="https://taoky.github.io/2018-07-14/language-gaokao-composition.html">&lt;p&gt;据说今年的高考全国都变得简单了。作为一个已经从高中毕业了一年多的「学长」，我恐怕也只能对语文科目的作文说上点什么了。在今年高考之后，我突然想写一下我省的作文题：&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;根据以下材料，选取角度，自拟题目，写一篇不少于800字的文章；文体不限，诗歌除外。&lt;/p&gt;

  &lt;p&gt;花解语，鸟自鸣，生活中处处有语言。&lt;/p&gt;

  &lt;p&gt;不同的语言打开不同的世界，音乐、雕塑、程序、基因……莫不如此。&lt;/p&gt;

  &lt;p&gt;语言丰富生活，语言演绎生命，语言传承文明。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;在去年考场&lt;del&gt;开车&lt;/del&gt;（大误）之后，其实我还是挺佩服江苏语文作文的出题人的。在其他省都在搞什么「任务驱动型」的时候，去年就写个车。当然，今年的作文题目也在全国是一股「清流」了。&lt;/p&gt;

&lt;!--more--&gt;

&lt;p&gt;我高中的作文水平不怎么样，从高二开始就不再写记叙文了，专心背论据，写议论文，但分数一直不高，而且我接下来打算写一篇小说。所以说，我无法保证接下来你看到的文字的质量。我根本没打算按照高考作文的「套路」去写，所以如果你还在准备高考，请&lt;strong&gt;不要&lt;/strong&gt;将接下来的文字当作高考范文之类的东西，否则后果自负。&lt;/p&gt;

&lt;p&gt;同时请注意，下面的小说&lt;strong&gt;可能存在事实性错误&lt;/strong&gt;，请避免将如下的内容作为讨论时的论据。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;2020 年。&lt;/p&gt;

&lt;p&gt;他是一名语言学家，但在业界没有什么名气。现在，他正飞往一处小岛。在那座岛屿上，还残留着一门濒危的语言，全世界总共也就只有岛屿上的十几名原住民还在使用这种语言。&lt;/p&gt;

&lt;p&gt;他是去给这门语言建立档案的，换句话说，就是把什么语法、词汇，还有当地的民间文学记录下来。毕竟岛上就那么些人，去「复兴」这门语言是根本做不到的。&lt;/p&gt;

&lt;p&gt;直升机缓缓降落在岛上，他找到了岛上唯一的原始部落区，向酋长说明来意后，酋长表示欢迎，随后说道：&lt;/p&gt;

&lt;p&gt;「现在已经没有人再愿意使用这门语言了。不仅是我们的孩子们，他们不愿意学，就连学过的成年人，他们在日常交流的时候，也用的是英语。毕竟，大家都想要更好的生活水平，而其中一个限制，就是我们的本土语言……」&lt;/p&gt;

&lt;p&gt;他面露难色，但知道自己也无法改变这种局面。&lt;/p&gt;

&lt;p&gt;「但不管怎么说，如果您需要什么，我们会尽力提供帮助。」&lt;/p&gt;

&lt;p&gt;之后，他用几天时间，尽力搜集第一手的资料。他并不喜欢去研究这门语言，之所以尽力，只是为了之后能少来这里几趟：一来，实验室的研究经费不多，划给这门语言的研究项目的钱更少，为了省钱，他不能一直到这里来；二来，他在这座小岛上也是水土不服，不管是食物还是气候，都让他感到厌恶。&lt;/p&gt;

&lt;p&gt;返程的时候，他想，为什么他高考之后报专业的时候，会选择语言学呢？他大概是忘了。他只是感觉，这样很累，而且一门只有十几个人说的语言，去拯救它……又有什么意义呢？&lt;/p&gt;

&lt;p&gt;他不知道。&lt;/p&gt;

&lt;p&gt;在第三次前往小岛，进行收尾工作的时候，飞机遭遇了恶劣天气。当他发现飞机已经失控，无力回天之后，他的脑海中像是走马灯一样，看到了故乡的麦田，他的父母、妻子……最后，是这门语言的符号。&lt;/p&gt;

&lt;p&gt;「之后没人会再去关注这门语言了吧，就像没人，会再去关注我一样。」&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;2050 年。&lt;/p&gt;

&lt;p&gt;一名年轻人在公开的语言学数据库的一个角落里，发现了一门独特的语言的档案。说它「独特」，是因为它的资料大体上齐全，但是从 2020 年文件创建开始，就没有人再去关注过这些资料了。&lt;/p&gt;

&lt;p&gt;是谁创建这些档案的呢？他不知道。不过，如此齐全的资料倒是很适合他的研究课题：使用人工智能的方式分析语言。在几个月的调参之后，他终于获得了大体满意的结果。&lt;/p&gt;

&lt;p&gt;他大概翻找了一下结果，没有发现什么「特别有价值」的东西，比如说像未来的预言、拯救世界的方法之类的。不过，这种情节，也只会在科幻小说里才会出现吧。&lt;/p&gt;

&lt;p&gt;尽管没有什么现实意义，阅读这些翻译后的作品也是一件有趣的事情。第一篇是日记，很简短，只是记录了打猎与种植的收获多少而已。第二篇则看起来像是原始的成文法，记录了犯下偷窃等罪行的时候会受到的惩罚……他继续看下去，他看到了更加丰富的生活记录，一些有趣的民歌，甚至还有一封情书。但到最后，他看到了几篇文章，是用这门原始的文字，夹杂着英文的动词与名词写成的。这些夹杂着的词，几乎都是描述西方 20 世纪之后出现的生活方式的。&lt;/p&gt;

&lt;p&gt;「恐怕，现在世界上，只有我才知道这门语言的内容了吧。」他之前向数据库管理员发邮件询问整理者的情况，但收到的回复却是，此人早已因空难离世了。&lt;/p&gt;

&lt;p&gt;他长叹一声。现在人们的语言越来越少了，不仅仅是自然语言，甚至编程语言也在逐渐统一起来。确实，这样的趋势有利于全世界人们相互交流，可我们会因此失去什么呢？&lt;/p&gt;

&lt;p&gt;他又看了一眼结果，似乎明白了什么。&lt;/p&gt;

&lt;p&gt;（完）&lt;/p&gt;</content>

      
      
      
      
      

      
        <author>
            <name>taoky</name>
          
          
        </author>
      

      
        <category term="小说" />
      

      
        <category term="高考" />
      
        <category term="作品" />
      

      
        <summary type="html">据说今年的高考全国都变得简单了。作为一个已经从高中毕业了一年多的「学长」，我恐怕也只能对语文科目的作文说上点什么了。在今年高考之后，我突然想写一下我省的作文题：</summary>
      

      
      
    </entry>
  
  
  
    <entry>
      
      <title type="html">高考，与高考之后……</title>
      
      
      <link href="https://taoky.github.io/2017-08-09/after-gaokao.html" rel="alternate" type="text/html" title="高考，与高考之后……" />
      
      <published>2017-08-09T11:29:29+00:00</published>
      <updated>2017-08-09T11:29:29+00:00</updated>
      <id>https://taoky.github.io/2017-08-09/after-gaokao</id>
      <content type="html" xml:base="https://taoky.github.io/2017-08-09/after-gaokao.html">&lt;p&gt;其实高考早就结束了，现在写这个东西可能太迟了一点。虽然其实我很早就想开始写了，但我真的懒得去敲键盘码字。&lt;/p&gt;

&lt;p&gt;在框架成功迁移到 Hexo 之后，我觉得是时候应该开始填坑了。（不过那篇关于 BMP 的文章我暂时不想填）&lt;/p&gt;

&lt;!--more--&gt;

&lt;h2 id=&quot;对高考的吐槽&quot;&gt;对高考的「吐槽」&lt;/h2&gt;

&lt;p&gt;今年的卷子……嗯……感觉非常诡异。整体难度比去年难（除了物理）。不过想到自己再也不用在试卷上填满 800 字的格子，不用去细想有机物官能团、合成路线这种对我来说考完之后就没有太大意义的东西，还是有点激动的。&lt;/p&gt;

&lt;p&gt;虽然说两门选修科目是可以「自由」选择的，但是为了留在理强，我不得不选择了据说（个人感觉）极其恐怖的化学。因为按照江苏卷的要求，物化最终的等第是按照比例分配的，而化学选的人比较少（意味着选择化学就需要与更多的「学霸」争抢 A+ 和 A）。虽然我自己觉得学 CS 的话化学和生物似乎都没有什么用。&lt;/p&gt;

&lt;p&gt;所以经过一番煎熬（高三下半学期真的非常痛苦），最终的战斗终于开始了……我现在当然不会说去后悔哪个答案填得不对，因为我考完之后根本没有去对答案，到现在为止我已经忘得一干二净了。&lt;/p&gt;

&lt;p&gt;（所有试卷在考试院网站上可以&lt;a href=&quot;http://www.jseea.cn/contents/channel_1/2017/06/1706092140912.pdf&quot;&gt;下载&lt;/a&gt;）&lt;/p&gt;

&lt;p&gt;只是有一些内心的「吐槽」想说吧：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;语文：
    &lt;ul&gt;
      &lt;li&gt;第二道单选第一眼看过去像病句题，然后四个选项扫过去都没问题，直到我看了题干……「下列句子中，没有使用比喻手法的一项是」还好考试还没正式开始。&lt;/li&gt;
      &lt;li&gt;为什么文言文会考文化常识题。「江左」「三代」「&lt;ruby&gt;菽&lt;rt&gt;shū&lt;/rt&gt;&lt;/ruby&gt;水」「趋庭」……反正我觉得四个都看上去是对的。&lt;/li&gt;
      &lt;li&gt;作文是……「车」？让人万万没想到啊。不过这种作文就只是看到的时候觉得很意外，但是其实写的时候角度很多。反正我是写车与生活节奏快慢的关系，也不知道有没有偏题。据说记叙文相比议论文优势很大，但不知道是不是真的。&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;数学：
    &lt;ul&gt;
      &lt;li&gt;据说是东南大学某教授出的卷子？嗯葛军后继有人了。&lt;/li&gt;
      &lt;li&gt;看上去不难，但就是来不及。&lt;/li&gt;
      &lt;li&gt;是&lt;ruby&gt;没&lt;rt&gt;mò&lt;/rt&gt;&lt;/ruby&gt;入水中还是&lt;ruby&gt;没&lt;rt&gt;méi&lt;/rt&gt;&lt;/ruby&gt;入水中呢？哈哈哈（当然我考试时候没有犯二，但标准答案两种都是对的）。&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;英语：
    &lt;ul&gt;
      &lt;li&gt;据说很难，但我个人感觉除作文之外就是做着有点虚而已。&lt;/li&gt;
      &lt;li&gt;作文居然写电影票房！居然是概括柱状图！还好考试前看了一下图表概括，但我还是不确定百亿的英文我有没有写对。不过现在围观了某生某世的这场滑稽戏后，突然觉得这个题目还蛮应景的。
        &lt;ul&gt;
          &lt;li&gt;可是作文为什么有两个「谈谈看法」？我到底应该写什么？&lt;/li&gt;
          &lt;li&gt;还有……唔……我作文好像超字数了。&lt;/li&gt;
          &lt;li&gt;结论：你以为你在考数学？你以为你在考英语？其实你还是在考语文。&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;物理：
    &lt;ul&gt;
      &lt;li&gt;比较简单。但我还是有几道题做的时候不确定。&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;化学：
    &lt;ul&gt;
      &lt;li&gt;很难。不过按照江苏卷的模式的话，很难的化学反而是对我有利的。&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;一切结束之后，看到课桌上我写的字条：「看到高考一天天接近，你感觉你自己充满了决心。」我想，我应该是用上了我自己的所有决心了。&lt;/p&gt;

&lt;h2 id=&quot;出成绩&quot;&gt;出成绩？&lt;/h2&gt;

&lt;p&gt;因为没有对答案，所以我只能大概估一下分。（满分 480）大概估计 380 ± 5，物化 A+ A 的样子（事实证明我还是太保守了）。&lt;/p&gt;

&lt;p&gt;然后也没什么事情干（又没有暑假作业），所以就呆在家里玩。在高考前一段时间，我用一本小本子写下了我高考后应该做的事情，然而我在这段时间真的没有按本子上的去做。懒癌发作了……&lt;/p&gt;

&lt;p&gt;出成绩的当天下午就每隔一个小时打一次电话问成绩。官方口径是晚上八点出，但在一个小时之前就可以查了。&lt;/p&gt;

&lt;p&gt;结果出乎意料。考得还不错。当时想这个分数去南大肯定没有问题（但是最终没有去）。&lt;/p&gt;

&lt;h2 id=&quot;选择&quot;&gt;选择&lt;/h2&gt;

&lt;p&gt;最终在南大和中科大中选。纠结了好几天，最终还是决定去中科大。当时我想我在班里最好的朋友也去科大，另外科大有著名的 LUG（至少从我家里访问&lt;a href=&quot;https://mirrors.ustc.edu.cn&quot;&gt;科大源&lt;/a&gt;的速度很快，并且科大源项目很全）。虽然这也意味着离家更远，数理科目成绩（大概率）被别人碾压，并且本科四年很有可能找不到女票。&lt;/p&gt;

&lt;p&gt;毕竟现在我想改也改不了了。而且我现在还要准备入学考试。&lt;/p&gt;

&lt;p&gt;不过我想，可能当时一个小变量的改变就会带来完全不一样的结果——如果考试时候突然脑子一抽（或者脑子一清醒）改了一个答案呢？如果在选学校的时候对各个因素加的权不一样呢？&lt;/p&gt;

&lt;p&gt;Who knows?&lt;/p&gt;

&lt;h2 id=&quot;乱写点什么&quot;&gt;乱写点什么&lt;/h2&gt;

&lt;p&gt;如果现在让我去高考考场的话，我肯定不能考到正常分数。因为大概两个月在家里之后，我已经把很多高考知识都忘了。大概在家里写点小程序（不是微信那个），玩玩游戏（嗯我玩了两遍 Undertale 的和平结局），看看书（其实看得不多），睡懒觉。在写程序的过程中我又明白了两件事情：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;移动端的触摸体验绝对不能忽视。（这一点上 eCharts 做得不太好，反正我被坑了）&lt;/li&gt;
  &lt;li&gt;大型项目构建的时候需要有统筹规划，与写这个项目的「实力」。（这一点说得比较虚……我本来想用 Python 写一个游戏的，一开始不停更换框架，然后面向对象搞不清楚，就一边写一边加函数。刚开始写的时候发现可能要用线程，照猫画虎添加了之后发现线程不安全的 pygame 不播放音乐了……一番折腾之后写到开屏动画结束，十几个函数互相调用，混乱到完成不下去了，结果弃坑）&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;出成绩之后和初中的老朋友们吃了一顿饭，他们似乎都考得不是特别好。最让我感到无奈的是爽哥，我不知道他高考时候发生了什么，可最后……唉……他似乎没有考满一本线，去了南大的一所附属学院，不过他也在计算机系。前段时间他特别认真的问我怎么学编程。学文科的老邓分数也无缘南大，最终去了武汉大学，离这里比合肥还要远一段。老温似乎去了湖南？我也不太确定。&lt;/p&gt;

&lt;p&gt;其实就算是我们班，也有人考出来分数与平时相比反常的。现在想来，高考其实是与很多因素都有关系的——不仅仅是实力。至少在我校考场上有人数学填空题没有填到答卷上，有人数学考试时候癫痫发作（从另外一个角度说明葛军「后继有人」）。&lt;/p&gt;

&lt;p&gt;其实写到这里，我开始有些害怕了，不知道我将会在大学面临什么。我当然清楚上大学不是去玩的，可是我究竟会遇见什么呢？&lt;/p&gt;

&lt;p&gt;祝我好运。祝各位好运。&lt;/p&gt;</content>

      
      
      
      
      

      
        <author>
            <name>taoky</name>
          
          
        </author>
      

      
        <category term="高考" />
      

      
        <category term="高考" />
      
        <category term="杂感" />
      

      
        <summary type="html">其实高考早就结束了，现在写这个东西可能太迟了一点。虽然其实我很早就想开始写了，但我真的懒得去敲键盘码字。</summary>
      

      
      
    </entry>
  
  
  
    <entry>
      
      <title type="html">从 Jekyll 向 Hexo 迁移</title>
      
      
      <link href="https://taoky.github.io/2017-08-08/migration-to-hexo.html" rel="alternate" type="text/html" title="从 Jekyll 向 Hexo 迁移" />
      
      <published>2017-08-08T20:26:46+00:00</published>
      <updated>2017-08-08T20:26:46+00:00</updated>
      <id>https://taoky.github.io/2017-08-08/migration-to-hexo</id>
      <content type="html" xml:base="https://taoky.github.io/2017-08-08/migration-to-hexo.html">&lt;p&gt;这里已经有很长时间没有更新了……今天突然看到了一些 Hexo 框架的主题，觉得很漂亮，再加上原来使用 Jekyll 的博客目录结构很混乱，我自己也搞不清楚哪个文件夹对应有什么功能，所以最终决定迁移过来。&lt;/p&gt;

&lt;p&gt;界面相比原来要更清晰一些。评论系统将会更换，因为使用 Disqus 的网络情况太过糟糕（不过还好的是，终于有人评论了我……可惜评论迁不过来）。另外将增加（并没有什么用的）站点统计。&lt;/p&gt;

&lt;p&gt;EOF&lt;/p&gt;</content>

      
      
      
      
      

      
        <author>
            <name>taoky</name>
          
          
        </author>
      

      
        <category term="Hexo" />
      

      
        <category term="Jekyll" />
      
        <category term="Hexo" />
      

      
        <summary type="html">这里已经有很长时间没有更新了……今天突然看到了一些 Hexo 框架的主题，觉得很漂亮，再加上原来使用 Jekyll 的博客目录结构很混乱，我自己也搞不清楚哪个文件夹对应有什么功能，所以最终决定迁移过来。</summary>
      

      
      
    </entry>
  
  
  
    <entry>
      
      <title type="html">使用 C++ 读取简单的 24、32 位 BMP 图像</title>
      
      
      <link href="https://taoky.github.io/2017-02-06/read-bmp-with-cpp.html" rel="alternate" type="text/html" title="使用 C++ 读取简单的 24、32 位 BMP 图像" />
      
      <published>2017-02-06T00:00:00+00:00</published>
      <updated>2017-02-06T00:00:00+00:00</updated>
      <id>https://taoky.github.io/2017-02-06/read-bmp-with-cpp</id>
      <content type="html" xml:base="https://taoky.github.io/2017-02-06/read-bmp-with-cpp.html">&lt;p&gt;BMP 是 Windows 下常见的一种位图格式。之所以我们选择直接读取 BMP 格式（即不使用其他的库）而非 JPG、PNG 等其他图像格式，是因为：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;BMP 的文档是公开的。没有版权、专利问题。&lt;/li&gt;
  &lt;li&gt;运用较广泛，常见。&lt;/li&gt;
  &lt;li&gt;结构相对简单，一般来讲没有压缩，代码容易写。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;接下来，我将尝试用最简单的方式来介绍 BMP 格式的结构，并且尽可能让之后出现的代码不依赖于具体的操作系统平台与特定的编译器实现。建议备一个十六进制查看器以方便理解。&lt;/p&gt;

&lt;p&gt;（下文可能会有错误，并且不会处理「特殊的」BMP 文件。等我高考完之后如果还有兴趣，可能会再去做其他情况下的 BMP 文件读取。）
&lt;!--more--&gt;&lt;/p&gt;

&lt;h2 id=&quot;文件头-1bitmapfileheader&quot;&gt;文件头 1：&lt;code class=&quot;highlighter-rouge&quot;&gt;BITMAPFILEHEADER&lt;/code&gt;&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;BITMAPFILEHEADER&lt;/code&gt; 有四小块。如下表：&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;名称&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;大小（字节）&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;介绍&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;bfType&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Windows 格式的 BMP 文件为「BM」。&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;bfSize&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;BMP 文件的大小。&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;bfReserved1&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;保留值。&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;bfReserved2&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;保留值。&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;bfOffBits&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;位图像素内容的偏移量（起始地址）。&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;可能没有什么特别的地方，&lt;code class=&quot;highlighter-rouge&quot;&gt;bfType&lt;/code&gt; 中检查是不是 &lt;code class=&quot;highlighter-rouge&quot;&gt;BM&lt;/code&gt; 就行了，OS/2 有其他类型的 BMP 格式，可是也不想想它死了多少年了……&lt;/p&gt;

&lt;p&gt;注意，文件头中的所有数据均以&lt;strong&gt;小端序&lt;/strong&gt;存放。（简单而很不严谨地说，就是字节倒着读）&lt;/p&gt;

&lt;h2 id=&quot;文件头-2bitmapinfoheader&quot;&gt;文件头 2：&lt;code class=&quot;highlighter-rouge&quot;&gt;BITMAPINFOHEADER&lt;/code&gt;&lt;/h2&gt;

&lt;p&gt;其实在这个位置是有其他版本的不同的文件头的，但是一般的 BMP 文件都是 &lt;code class=&quot;highlighter-rouge&quot;&gt;BITMAPINFOHEADER&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;它有十一小块，如下表：&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;名称&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;大小（字节）&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;介绍&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;biSize&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;此文件头（&lt;code class=&quot;highlighter-rouge&quot;&gt;BITMAPINFOHEADER&lt;/code&gt;）的大小。&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;biWidth&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;图像的宽度，以像素为单位。&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;biHeight&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;图像的高度，以像素为单位。&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;biPlanes&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;图像的色彩平面，正常情况下均为 1。&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;biBitCount&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;2&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;每个像素的位数。&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;biCompression&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;BMP 文件的压缩种类，0 为无压缩。&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;biSizeImage&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;位图像素内容的大小，无压缩时可以填 0。&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;biXPelsPerMeter&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;图像横向每米存放的像素。&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;biYPelsPerMeter&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;图像纵向每米存放的像素。&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;biClrUsed&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;图像使用的色彩数，可以为 0。&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;biClrImportant&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;4&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;图像使用的「重要」的色彩数，0 时均重要。&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;因为我们不想写解压算法，所以需要保证处理的 BMP 文件的 &lt;code class=&quot;highlighter-rouge&quot;&gt;biCompression&lt;/code&gt; 为 0。我们之后也不想处理调色板（Color Table, Palette），而是直接读取像素内容，所以需要保证 &lt;code class=&quot;highlighter-rouge&quot;&gt;biBitCount&lt;/code&gt; 为 24 或者 32（即 24 或 32 位的位图），因为它们一般是不含调色板的。&lt;/p&gt;

&lt;p&gt;注意，图像的高度&lt;strong&gt;可以为负&lt;/strong&gt;。负数值表示接下来的像素内容将从左上角从左到右、从上到下读取；而正数值表示接下来的像素内容将从右下角从左到右、从下到上读取。必要的时候请记得取绝对值。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/pictures/bmp-cpp/1.png&quot; alt=&quot;对高度取相反数后的结果&quot; /&gt;&lt;/p&gt;

&lt;p&gt;（对 &lt;code class=&quot;highlighter-rouge&quot;&gt;biHeight&lt;/code&gt; 取相反数后的结果，改了四个字节，图像就反过来了～）&lt;/p&gt;

&lt;h2 id=&quot;像素内容&quot;&gt;像素内容&lt;/h2&gt;

&lt;p&gt;接下来就是我们期待的位图像素内容了。我们之前说过&lt;strong&gt;忽略&lt;/strong&gt;了调色板等其他的东西，所以在 &lt;code class=&quot;highlighter-rouge&quot;&gt;BITMAPINFOHEADER&lt;/code&gt; 之后便直接是像素内容了。&lt;/p&gt;

&lt;p&gt;标题中只写了 24 位和 32 位的图像，所以更低的位数不考虑。（毕竟你现在，除了在 gif 动图之外，还能见到 8 位色的图像吗？）&lt;/p&gt;

&lt;p&gt;在 24 位（3 字节）的位图中，每个像素按&lt;strong&gt;顺序&lt;/strong&gt;由三部分组成：蓝色值、绿色值、红色值。32 位（4 字节）的图像添加了 Alpha 透明度部分，在红色值后添加了一字节的 Alpha 值（不透明的 32 位 BMP 图像，每个像素的 Alpha 值字节十六进制均为 &lt;code class=&quot;highlighter-rouge&quot;&gt;FF&lt;/code&gt;）。&lt;/p&gt;

&lt;p&gt;然后我们只需要一个一个读就行了吗？&lt;/p&gt;

&lt;p&gt;当然不是。还有一个特别的注意点：&lt;strong&gt;图像每行的字节大小都必须是 4 字节的倍数。&lt;/strong&gt;不足的需要补齐。当然很明显的是，32 位的 BMP 就不需要考虑这一点了。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;一切准备好了。所以，让我们开干吧。&lt;/p&gt;

&lt;h2 id=&quot;具体实现&quot;&gt;具体实现&lt;/h2&gt;

&lt;p&gt;（这个实现比较草率，因为我确实时间不多了。）&lt;/p&gt;

&lt;p&gt;首先把两个文件头，加上表示像素的结构，包在 &lt;code class=&quot;highlighter-rouge&quot;&gt;struct&lt;/code&gt; 里面：&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;BITMAPFILEHEADER&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bfType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// must be &quot;BM&quot;&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bfSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// the size of the bmp file&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bfReserved1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bfReserved2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bfOffBits&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// the offset to the bitmap data&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;FileHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;BITMAPINFOHEADER&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;biSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// the size of BITMAPINFOHEADER&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;biWidth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// width (pixels)&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;biHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// height (pixels)&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;biPlanes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// color planes&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;biBitCount&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// bits per pixel&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;biCompression&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// type of compression (0 is no compression)&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;biSizeImage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// the origin size of the bitmap data (before compression)&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;biXPelsPerMeter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// horizontal pixels per meter&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;biYPelsPerMeter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// vertical pixels per meter&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;biClrUsed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// the number of colors used&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;biClrImportant&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// &quot;important&quot; colors, usually 0&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;InfoHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Pixel&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;为了能够把小端序转换成整型变量，我们还需要一个小函数：&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kr&quot;&gt;inline&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ToHumanRead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;// Convert to Big Endian&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;l&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;memcpy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;l&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;signed&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;l&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;在主函数部分，我们先读取文件，然后进行进一步操作：&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[])&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;argc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Parameters Error.&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Use: &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot; xxxx.bmp&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;bmpfile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ios&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ios&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;binary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// open the file&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bmpfile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;is_open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;bmpfile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FileHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FileHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// Read BITMAPFILEHEADER&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strncmp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FileHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bfType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;BM&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// Judge whether a BMP.&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Not a BMP File, or an Unsupported OS/2 BMP File.&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;bmpfile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InfoHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InfoHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// Read BITMAPINFOHEADER&lt;/span&gt;
    &lt;span class=&quot;cm&quot;&gt;/* Information Output */&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Output_FileHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Output_InfoHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;cm&quot;&gt;/* Output End */&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;vector&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Pixel&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ReadBitmap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// Read the data&lt;/span&gt;
    
    &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cin&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;PrintLocation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// Close file and delete vec&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;bmpfile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;delete&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Open File Error.&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;其中的 &lt;code class=&quot;highlighter-rouge&quot;&gt;vector&lt;/code&gt; 是用来储存像素内容的，Output 部分输出 BMP 文件头内容，使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;ReadBitmap()&lt;/code&gt; 读入后等待用户输入坐标，显示对应像素的 RGB 值。&lt;/p&gt;

&lt;p&gt;Output 部分：&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Output_FileHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;File Size (BITMAPFILEHEADER): &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ToHumanRead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FileHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bfSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Reserved 1 (usually 0, BITMAPFILEHEADER): &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ToHumanRead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FileHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bfReserved1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Reserved 2 (usually 0, BITMAPFILEHEADER): &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ToHumanRead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FileHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bfReserved2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Bitmap Data Offset (BITMAPFILEHEADER): &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ToHumanRead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FileHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bfOffBits&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Output_InfoHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;BITMAPINFOHEADER Size: &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ToHumanRead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InfoHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;biSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Width (BITMAPINFOHEADER): &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ToHumanRead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InfoHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;biWidth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Height (BITMAPINFOHEADER): &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ToHumanRead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InfoHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;biHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Number of Color Planes (BITMAPINFOHEADER): &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ToHumanRead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InfoHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;biPlanes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Number of Bits per Pixel (BITMAPINFOHEADER): &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ToHumanRead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InfoHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;biBitCount&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Compression Type (0 is none, BITMAPINFOHEADER): &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ToHumanRead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InfoHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;biCompression&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Original Size of Bitmap (0 usually if no compression, BITMAPINFOHEADER): &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ToHumanRead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InfoHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;biSizeImage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Number of Horizontal Pixels per Meter (0 usually, BITMAPINFOHEADER): &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ToHumanRead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InfoHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;biXPelsPerMeter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Number of Vertical Pixels per Meter (0 usually, BITMAPINFOHEADER): &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ToHumanRead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InfoHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;biYPelsPerMeter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Number of Color Used (0 sometimes, BITMAPINFOHEADER): &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ToHumanRead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InfoHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;biClrUsed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Number of Important Color (0 means all is important, BITMAPINFOHEADER): &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ToHumanRead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InfoHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;biClrImportant&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;写得比较草率。将文件头的内容全部输出。&lt;/p&gt;

&lt;p&gt;读取部分：&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;drop_alpha&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ToHumanRead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InfoHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;biBitCount&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;bmpfile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;vector&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Pixel&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;ReadBitmap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;height&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ToHumanRead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InfoHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;biHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;width&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ToHumanRead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InfoHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;biWidth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;linebyte&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;width&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ToHumanRead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InfoHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;biBitCount&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;linebyte&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// &quot;linebyte&quot; should be the multiple of 4&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;// cout &amp;lt;&amp;lt; &quot;Bytes per line: &quot; &amp;lt;&amp;lt; linebyte &amp;lt;&amp;lt; endl;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Offset: &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;vector&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Pixel&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vec&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vector&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Pixel&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;abs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)];&lt;/span&gt;
  &lt;span class=&quot;c1&quot;&gt;// Height could be a negative number.&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;isBottom&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ToHumanRead&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InfoHeader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;biHeight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// read from bottom&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;isBottom&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;abs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;bmpfile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isBottom&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;push_back&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;height&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;push_back&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;drop_alpha&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;offset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;bmpfile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;drop_alpha()&lt;/code&gt; 是为了把 32 位位图中的 Alpha 信息丢掉，方便处理，当然你也可以把它们留着……&lt;code class=&quot;highlighter-rouge&quot;&gt;ReadBitmap()&lt;/code&gt; 部分先计算 &lt;code class=&quot;highlighter-rouge&quot;&gt;offset&lt;/code&gt;（每行需要补齐的字节），再根据高度的正负值分类读取数据。&lt;/p&gt;

&lt;p&gt;最后一个部分，输出 RGB 值：&lt;/p&gt;

&lt;div class=&quot;language-cpp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;PrintLocation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vector&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Pixel&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;vec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot; &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;g&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot; &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;vec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;完整的代码在&lt;a href=&quot;/attachments/bmp1.cpp&quot;&gt;此&lt;/a&gt;。&lt;/p&gt;

&lt;h2 id=&quot;参考链接&quot;&gt;参考链接：&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://web.archive.org/web/20080912171714/http://www.fortunecity.com/skyscraper/windows/364/bmpffrmt.html&quot;&gt;The .bmp file format&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/BMP_file_format&quot;&gt;BMP file format (Wikipedia)&lt;/a&gt;&lt;/p&gt;</content>

      
      
      
      
      

      
        <author>
            <name>taoky</name>
          
          
        </author>
      

      
        <category term="程序" />
      

      
        <category term="C++" />
      
        <category term="BMP" />
      

      
        <summary type="html">BMP 是 Windows 下常见的一种位图格式。之所以我们选择直接读取 BMP 格式（即不使用其他的库）而非 JPG、PNG 等其他图像格式，是因为：</summary>
      

      
      
    </entry>
  
  
  
    <entry>
      
      <title type="html">《你的名字。》观后感——一个关于梦、改变和灾难的故事</title>
      
      
      <link href="https://taoky.github.io/2017-02-02/yourname-my-review.html" rel="alternate" type="text/html" title="《你的名字。》观后感——一个关于梦、改变和灾难的故事" />
      
      <published>2017-02-02T00:00:00+00:00</published>
      <updated>2017-02-02T00:00:00+00:00</updated>
      <id>https://taoky.github.io/2017-02-02/yourname-my-review</id>
      <content type="html" xml:base="https://taoky.github.io/2017-02-02/yourname-my-review.html">&lt;p&gt;《你的名字。》（下简称「君名」）第一次是我在 12 月 2 日和爸妈去电影院看的。记得那天高三破天荒全校第一个放假。一开始是几周前看到一帮人在安利之后想去看的，然后在那天下午看了一遍预告片，感觉……不知道它到底想讲一个什么故事。我很担心君名的风格适不适合我，但最后还是因为好奇心拉着爸妈去看了（虽然我爸更想看《神奇动物在哪里》）。毕竟我没有女票，也没有住得近、一下子就能约出来的朋友，一个人去看也不太可能会被批准的啊 -_-。&lt;/p&gt;

&lt;p&gt;当然看完之后感觉很棒（不然我就不会写这篇观后感了），虽然第一次看之后感觉时间线有点混乱。记得上一次感觉「这部电影好棒啊」的时候是在小高考考完之后去看《疯狂动物城》的那次。&lt;/p&gt;

&lt;p&gt;过了两个月了，我基本把所有能看到的资料都看了一遍，电影又看了两遍——虽然是盗版的片源（YN-009 那个，个人各种原因没有机会再去买电影票了）。或许现在我能用我糟糕的文笔来写写我的想法了吧。下面写的有点乱，见谅。&lt;/p&gt;

&lt;p&gt;（有剧透）
&lt;!--more--&gt;
—&lt;/p&gt;

&lt;h2 id=&quot;梦&quot;&gt;梦&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;梦里相逢人不见，若知是梦何须醒。&lt;/p&gt;

  &lt;p&gt;纵然梦里常幽会，怎比真如见一回。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;据说这首和诗为君名的灵感来源之一。它的内容与君名的情节也是有关联的。对泷和三叶来说何尝不是如此。互相切换到对方的身体中，虽然切换后的经历实际上对现实世界是有影响的，但对对方而言，这确实是像一场梦。这场梦中的记忆在恢复正常醒来后就渐渐消失，正如我们平常做梦时的体验一样。&lt;/p&gt;

&lt;p&gt;在电影中，他们在长大之前只真正相见过一次。而他们这一次真正的相见，在「黄昏之时」的作用下，也像梦一样跨越了 3 年的时间差（2013、2016），才短暂地实现。&lt;/p&gt;

&lt;p&gt;不过最终电影给我们的是一个美好的结局。尽管双方的记忆都已经淡忘，但这样一系列的梦所留下的印象与双方的勇气造就了他们最终的相遇。虽然可惜他们忘记了交换身体、拯救糸（丝，sī）守镇的经历，但至少他们能够相遇并认出彼此，不再像梦一样虚幻、模糊，而不是跟《秒速五厘米》中贵树与明里最后被两辆相向而行的列车隔开的结局一样。&lt;/p&gt;

&lt;h2 id=&quot;改变&quot;&gt;改变&lt;/h2&gt;

&lt;p&gt;君名比较明显能让人感受到的一个主题就是「改变」。居住在糸守镇的三叶厌倦了她的乡村生活——缺少咖啡厅等现代化生活的元素、与镇长父亲之间的隔阂、继承传统宗教风俗的尴尬与在学校里缺少朋友的状况，给她的生活蒙上了一些阴影，甚至让她喊出「请让我来世变成东京的帅哥吧」这样看上去有点「无厘头」的话。&lt;/p&gt;

&lt;p&gt;同样，在泷的一方，虽然他和朋友们相处融洽，但从他的日记可以看出，在三叶到来之前，他的生活也是单调的。但在两人交换身体之后，他们给对方带来了积极的改变。在约 4 分钟的《前前前世》歌曲的一段中，君名用片段的方式展现了双方交换之后的状态。泷用自己「霸气」的表现帮三叶在学校中建立威望，反抗欺凌，甚至让她同时收到男女生的表白。而三叶则帮助泷与前辈建立关系，最后还为他安排好了一场约会……影片中这一段非常有趣，用不太多的画面展现出了这样的「改变」。&lt;/p&gt;

&lt;p&gt;而这样的一种改变，让泷在交换停止后决定以他仅有的几幅糸守画像为线索，动身去找三叶，也让三年前的她在彗星到来的前一天（用她好几个月的生活费）去东京找泷，尽管她三年前的尝试最终失败了（毕竟当时泷还不认识三叶）。这样的改变也解释了为什么在多次的交换身体后泷会渐渐喜欢三叶，而不是无缘无故地产生好感。&lt;/p&gt;

&lt;h2 id=&quot;灾难&quot;&gt;灾难&lt;/h2&gt;

&lt;p&gt;君名中出现的那颗可怕的彗星三次砸向糸守镇（概率很小的事情啊……里面一定有「幕后黑手」（笑））。而这颗虚构的彗星并非完全空穴来风，它实则暗示 2011 年 3 月 11 日发生在日本东北部的大地震。正如彗星将整个小镇毁灭一样，那场地震也破坏了大量的城镇，夺走了一万多人的生命。&lt;/p&gt;

&lt;p&gt;可能 311 地震给日本带来的影响近似于 08 年四川汶川大地震给我们带来的心理影响。我没有经历过什么大的自然灾害，所以并没有什么太深的感觉。但是我可以理解当昨天还能开开心心聊天的朋友在今天他，连他所属的小镇都在地图上抹去时的感受。每天都要担心灾害降临的感觉是很可怕的，毕竟这是一个多灾多难的地方。&lt;/p&gt;

&lt;p&gt;所以在君名最后，长大后的泷找工作面试时会说「你不知道东京哪天也会消失，所以哪怕只能留下记忆……」如果一切都会有终结，留下一片记忆，一块自己在今生今世存在过的证据，或许也是可以的啊。&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;关于其他&quot;&gt;关于其他……&lt;/h2&gt;

&lt;p&gt;第一遍看完君名后我隐约有这样一种感觉：「要是这个故事是真的，那该有多美好啊」。尽管若深究下去，它在情节等方面的漏洞并不少，还有那个在我看的时候瞬间让我出戏的 Google 的图标（2013 年的时候 Google 还没有换新图标，但在电影里三叶（实际是泷）与朋友计划拯救糸守镇时（2013）出现了新图标）。&lt;/p&gt;

&lt;p&gt;但至少我个人认为这是一部佳作，并且它成功让我难以释怀了很长一段时间（笑）。它的结局不再是像新海诚之前的电影一样的悲剧结局（如果是悲剧的话，恐怕难以接受吧……），可我看完之后甚至有点孤独的感觉，不知道怎么说才好。&lt;/p&gt;

&lt;p&gt;另外，君名的音乐很赞，推荐。&lt;/p&gt;</content>

      
      
      
      
      

      
        <author>
            <name>taoky</name>
          
          
        </author>
      

      
        <category term="影评" />
      

      
        <category term="影评" />
      
        <category term="《你的名字。》" />
      

      
        <summary type="html">《你的名字。》（下简称「君名」）第一次是我在 12 月 2 日和爸妈去电影院看的。记得那天高三破天荒全校第一个放假。一开始是几周前看到一帮人在安利之后想去看的，然后在那天下午看了一遍预告片，感觉……不知道它到底想讲一个什么故事。我很担心君名的风格适不适合我，但最后还是因为好奇心拉着爸妈去看了（虽然我爸更想看《神奇动物在哪里》）。毕竟我没有女票，也没有住得近、一下子就能约出来的朋友，一个人去看也不太可能会被批准的啊 -_-。</summary>
      

      
      
    </entry>
  
  
  
    <entry>
      
      <title type="html">无标题</title>
      
      
      <link href="https://taoky.github.io/2017-01-17/untitled.html" rel="alternate" type="text/html" title="无标题" />
      
      <published>2017-01-17T00:00:00+00:00</published>
      <updated>2017-01-17T00:00:00+00:00</updated>
      <id>https://taoky.github.io/2017-01-17/untitled</id>
      <content type="html" xml:base="https://taoky.github.io/2017-01-17/untitled.html">&lt;p&gt;/*&lt;/p&gt;

&lt;p&gt;这是一篇风格随意的自编小说，灵感源于敝校期末作文讲义第一篇文章的标题。已经有 1 年没有在博客上写什么东西了。趁这个机会让它「苏醒」一下吧。&lt;/p&gt;

&lt;p&gt;献给所有有着「作文写作困难症」的同学。&lt;/p&gt;

&lt;p&gt;*/&lt;/p&gt;

&lt;p&gt;他新建了一个文档。
&lt;!--more--&gt;
空窗口。标题栏写着「Untitled」，窗口的左上角是红绿灯式的窗口控制按钮——分别是红色的关闭、黄色的最小化、绿色的全屏。但他暂时还不想去碰它们中的任何一个。他只将窗口拉到中央，看着右上角的「0 Words」，又看着闪烁着的光标。发呆。&lt;/p&gt;

&lt;p&gt;他是怎么新建这个文档的呢？文件管理器里右键只有「新建文件夹」。他当然不会把文件夹当作文档的啊，因为它们不是文件——等一下，他想起来，在 Unix 的「哲学」体系中，没有什么东西不是文件啊，显示器是，打印机是，他自己应该也是的吧。文件是「绳结」啊，所以文件夹是文件，所以自己错了。他连忙下意识按了几下 &lt;code class=&quot;highlighter-rouge&quot;&gt;delete&lt;/code&gt; 键，可屏幕上什么反应都没有。他只能听到细小的模拟打字机音效的声音。&lt;/p&gt;

&lt;p&gt;而这细小的「嚓嚓」声把他拉回了现实。他望了望那张纸，上面写着他所需要遵循的各类要求。于是，他脑海中出现了一个中心主题结点，在它的周围围绕着各种各样稀奇古怪的名词，但他，用了不知多少个五分钟，却找不到一条与结点相连的边。那些名词一点一点散去，最终一切消失殆尽，除了那个中心主题结点。这张图（如果在数学上还算是的话）只有结点，还只有一个，而且没有边。真是无聊。&lt;/p&gt;

&lt;p&gt;他瞪大眼睛看着屏幕，看着最顶上的菜单栏，嘴唇轻微颤动着：「File. Edit. Paragraph. Format. View. Themes. Window. Help. Help. Help…」他最终在「Help」选单处陷入了一个死循环。他还真的去点了点。他渴望帮助，但这里的帮助，却不是他想要的。&lt;/p&gt;

&lt;p&gt;他要疯了。他想撕掉那张纸，可没法撕掉。他想关闭这个空荡荡的文本界面，于是大拇指按下 &lt;code class=&quot;highlighter-rouge&quot;&gt;Command (⌘)&lt;/code&gt; ，食指碰到了 &lt;code class=&quot;highlighter-rouge&quot;&gt;Q&lt;/code&gt; 键，却停了下来。他冷静了一些。他瞄了眼时间，距离他新建文档，已经有一个小时过去了。也许他应该选择一个更加「心无杂念」的界面。因此，他移动指针到「全屏」按钮，手指在触控板上一点。一个看烦了的动画效果。全屏了。这是真正的空白，除却那个依旧在原位闪烁的光标之外。&lt;/p&gt;

&lt;p&gt;可那个结点，那个中心主题结点，又出现了，好像是印在电脑屏幕上一样。他不想再去看那个结点了。他手指在触控板上用力回旋着，想甩掉那个点，可他只获得了一个放大了的指针。或许他应该听一会儿音乐吧，他想。轻拍了一下 &lt;code class=&quot;highlighter-rouge&quot;&gt;F8&lt;/code&gt; 键，音乐就开始播放了。那个按键上面是一个等边三角形，和两个矩形，以特定的方式排列，就拥有了播放与暂停的隐喻。他听着音乐，继续发呆。他现在能且仅能做这件事情了。&lt;/p&gt;

&lt;p&gt;所以已经过去了三个小时，他什么都没——好像这么说有失偏颇，毕竟他还是在电脑以为无人操作，将屏幕变暗的时候，蹭了蹭触控板的。死线要到了，他不能再这么下去了。他关闭了全屏。开始真正郑重其事地把手放在键盘上。&lt;/p&gt;

&lt;p&gt;然后呢？&lt;/p&gt;

&lt;p&gt;他把那张纸扔在了一旁不看。脑子里终于出现了一个框架，虽然简陋，而且不合「主题」。&lt;/p&gt;

&lt;p&gt;他终于开始输入了第一句有意义的句子：&lt;/p&gt;

&lt;p&gt;「他新建了一个文档。」&lt;/p&gt;

&lt;p&gt;（完）&lt;/p&gt;</content>

      
      
      
      
      

      
        <author>
            <name>taoky</name>
          
          
        </author>
      

      
        <category term="小说" />
      

      
        <category term="作品" />
      

      
        <summary type="html">/*</summary>
      

      
      
    </entry>
  
  
  
    <entry>
      
      <title type="html">信任与不信任</title>
      
      
      <link href="https://taoky.github.io/2015-09-27/trusting-or-not.html" rel="alternate" type="text/html" title="信任与不信任" />
      
      <published>2015-09-27T00:00:00+00:00</published>
      <updated>2015-09-27T00:00:00+00:00</updated>
      <id>https://taoky.github.io/2015-09-27/trusting-or-not</id>
      <content type="html" xml:base="https://taoky.github.io/2015-09-27/trusting-or-not.html">&lt;p&gt;XcodeGhost 应该是创下了 App Store 的先河了，之前里面曾出现过的恶意软件应该不会超过个位数，但自从爆发之后，这种安全性就有点被打破了的味道。归根到底，就是开发者没有安全意识，或者说是过于天真吧。&lt;/p&gt;

&lt;p&gt;这件事情其实各方都有责任，Apple 的 Mac App Store 做得实在太差：经常连接不上，连接上了还很难下载：经常下载到一半就失败了；Apple Developer Program 没有提供 sha1 校验码；开发者作死关了 Gatekeeper，不了解 OS X 应用的数字证书……这件事闹得太大，很多著名应用被感染，以至于 Apple 发出了一个&lt;a href=&quot;http://www.apple.com/cn/xcodeghost/&quot;&gt;申明&lt;/a&gt;。
&lt;!--more--&gt;&lt;/p&gt;

&lt;p&gt;不过，这件事情也是很让人大开眼界的：原来在 IDE 里也可以做手脚！然而 XcodeGhost 并不是第一个做这件事的。Ken Thompson，UNIX 的创造者之一，在他获得图灵奖后做了一个演讲：「Reflections on Trusting Trust」。演讲中他证明了可以在编译器里加入代码，使得编译出来的程序（包括编译器自己）都是有问题的。也就是说，不管有问题的编译器用正确的代码自举（Bootstrap）多少次，结果还是有可能有问题。在最后一部分，他说了这样一句话：&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;You can’t trust code that you did not totally create yourself.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;如果在一个不被信任的平台上建东西，无论建造过程有多么规范严谨，它也不应该被信任。这样想想其实挺恐怖的：你信任你的编译器吗？你信任你的操作系统吗？你信任你的 BIOS/UEFI 吗？你信任你的硬件吗？&lt;/p&gt;

&lt;p&gt;恐怕到最后，结果只有「不」这个字了。&lt;/p&gt;

&lt;p&gt;说到这个，我想到了 Richard Stallman。他用的笔记本从操作系统到 BIOS 全部都是开源的（因此他还用过龙芯的笔记本，不过在 2012 年被偷了）。现在把所有的软件和固件全部都换成开源的并不是很现实的事情。诚然大部分都可以替换，但 Flash 呢？各种各样的音视频格式呢？驱动程序呢？以前我看到有人说「RMS 永远是对的」，现在想来，他至少在这件事情上虽然太过激了点，但确实是对的。&lt;/p&gt;

&lt;p&gt;你看不出闭源的东西里面构造是什么，那么开源的也可以完全信任吗？不。诚然，开源程序可以看到内部的构造，然而可能根本没耐心看、看不懂或是没有发现隐蔽的问题。开源有时比闭源更加可以信任些，但也很难达到「完全信任」的程度，不然 OpenSSL 的「心脏流血」就不会隔这么长时间才被发现了。毕竟，大部分人都不会自己去编译的，而是用别人编译好的二进制文件。&lt;/p&gt;

&lt;p&gt;说到底，做到使用环境能被「完全信任」实在太难，更别说「人」自己也没有办法被完全信任。&lt;/p&gt;

&lt;p&gt;这个问题，恐怕找不到一个完美的解决方案。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;据说写 XcodeGhost 的作者还是个学生。我只能用 Ken Thompson 演讲的最后一段来说了。&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;I have watched kids testifying before Congress. It is clear that they are completely unaware of the seriousness of their acts. There is obviously a cultural gap. The act of breaking into a computer system has to have the same social stigma as breaking into a neighbor’s house. It should not matter that the neighbor’s door is unlocked. The press must learn that misguided use of a computer is no more amazing than drunk driving of an automobile.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;现在媒体「misguide」的情况不多了，但如果 XcodeGhost 的编写者真的只是学生，真是只是像他声明里面说的那样没有恶意的话，那他就是「completely unaware of the seriousness of their acts」。&lt;/p&gt;

&lt;p&gt;唉。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;附：我对演讲 Reflections on Trusting Trust 的渣翻译&lt;/p&gt;

&lt;h4 id=&quot;简介&quot;&gt;简介&lt;/h4&gt;

&lt;p&gt;我感谢 ACM 给我这个奖项。我不得不感觉到我得到了这个奖是因为机缘巧合和技术的价值。UNIX 迅速流行，给工业从 central main frames（？）到 autonomous minis（？）带来了巨大改变。我推测 Daniel Bobrow 会代替我站在这里，如果他付不起一台 PDP-10 并且要付清 PDP-11 的欠款的话。此外，现在 UNIX 的情况是由许许多多人的辛勤劳动建筑成的。&lt;/p&gt;

&lt;p&gt;有句老话，「和那个带你来的人跳舞」（Dance with the one that brought you），意思是说我应该谈谈 UNIX 了。我已经很长时间没有为主流 UNIX 工作了，但我仍旧继续因为其他人的工作而得到不应有的赞扬。所以，我不想再谈 UNIX 了，但我想感谢每个作出贡献的人。那把我带给了 Dennis Ritchie。我们的合作已成为一件美好的事情。在我们过去共同工作的十年里，我只能回忆起一件协作不佳的事。那一次，我发现我们都写了相同的 20 行的汇编程序。我对比了源代码，震惊地发现它们每个字符都毫无差别。我们共同工作的结果已经大大超过我们各自的贡献。我是一个程序员。在我的 1040 税收表格上，我的职业就是这么写的。我想给你们展示一下我曾写过的最可爱的程序。我用三步做了这件事，并且最后把它们放在了一起。&lt;/p&gt;

&lt;h4 id=&quot;第一步&quot;&gt;第一步&lt;/h4&gt;

&lt;p&gt;在大学里有电子游戏之前，我们用展示编程练习的方式来愉悦自己。我的其中一个最爱，就是写出最短的可以自我复制的程序。既然这是一个与现实分离的练习，我经常用的是 FORTRAN。的确，选择 FORTRAN 语言的原因和二人三足游戏流行的原因，是一样的。&lt;/p&gt;

&lt;p&gt;更清晰地说，这个问题是写出一个源码，当它被编译并执行时，会输出一份自身源代码的精确复制。如果你从来都没有做过这种事情，我强烈建议你自己去试试。自己去探寻如何做事情是一次披露，这远胜过任何被别人告知如何去做的好处。所谓「最短」只是一种刺激来证明技能以及选出冠军。&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;sc&quot;&gt;'\t'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;sc&quot;&gt;'0'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;sc&quot;&gt;'\n'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;sc&quot;&gt;'}'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;sc&quot;&gt;';'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;sc&quot;&gt;'\n'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;sc&quot;&gt;'\n'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;sc&quot;&gt;'/'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;sc&quot;&gt;'*'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;sc&quot;&gt;'\n'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;删除了&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;213&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;行&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;cm&quot;&gt;/*
 * 字符串 s 是一个
 * 对从 '0' 到结尾的
 * 主体程序的
 * 描述。
 */&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;char&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;s[ ] = {&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    	&lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\r&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;%d, &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;%s&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;这里是一些简单的翻译，&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;使得一个不编写&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;C&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;的程序员也能看懂这段程序。&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;		&lt;span class=&quot;err&quot;&gt;赋值&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;		&lt;span class=&quot;err&quot;&gt;等于&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt;		&lt;span class=&quot;err&quot;&gt;不等于&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;		&lt;span class=&quot;err&quot;&gt;增加&lt;/span&gt;
&lt;span class=&quot;sc&quot;&gt;'x'&lt;/span&gt;		&lt;span class=&quot;err&quot;&gt;简单的字符常量&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;&quot;xxx&quot;&lt;/span&gt;	&lt;span class=&quot;err&quot;&gt;多重字符串&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt;		&lt;span class=&quot;err&quot;&gt;转换到十进制数格式&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;		&lt;span class=&quot;err&quot;&gt;转换到字符串格式&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;		&lt;span class=&quot;n&quot;&gt;tab&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;制表符&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;\&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;		&lt;span class=&quot;err&quot;&gt;新行符号&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;em&gt;插图 1&lt;/em&gt;（注：原来是图片）&lt;/p&gt;

&lt;p&gt;插图 1 向我们展示了一个用 C 语言编写的自我复制程序。（纯粹主义者会说这个程序并不完全是一个自我复制程序，但会产生一个自我复制程序）这东西太大，没法拿奖，但它证明了这项技术，并且我需要两个重要的特性来完成我的故事：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;这个程序可以容易地被另一个程序编写&lt;/li&gt;
  &lt;li&gt;这个程序可以包含一个任意数量的过度超重的行李（？，excess baggage）来被与主算法一起复制。在这个例子里，甚至是注释也被复制了。&lt;/li&gt;
&lt;/ol&gt;

&lt;h4 id=&quot;第二步&quot;&gt;第二步&lt;/h4&gt;

&lt;p&gt;C 编译器是用 C 语言编写的。我想说的是这个其中一个在编译器用它们自己的语言编写时的「先有鸡还是先有蛋」问题。这个例子里，我会用一个 C 编译器中的特定例子。&lt;/p&gt;

&lt;p&gt;C 允许一个字符串结构来具体说明一个已被初始化的字符数组。在字符串中的单独的字符可以被转义到显示不可打印字符。比如说，&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;s&quot;&gt;&quot;Hello world&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;相当于一个包含字符 &lt;code class=&quot;highlighter-rouge&quot;&gt;\n&lt;/code&gt; 的字符串，它表示新行符号。&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;'\\'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;'\\'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;'\\'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;'n'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;'\n'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;em&gt;插图 2&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;插图 2 是一个理想化的在 C 编译器中的代码来解释字符转义序列。这是段令人惊奇的代码。它用一种很方便的方式「知道」在任意字符集下什么字符代码被编译成新行。这种知道的艺术允许它自编译，所以延续了知识（？）。&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;'\\'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;'\\'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;'\\'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;'n'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;'\n'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;'v'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;'\v'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;em&gt;插图 3&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;假设我们希望改变 C 编译器来包括序列 &lt;code class=&quot;highlighter-rouge&quot;&gt;\v&lt;/code&gt; 显示垂直制表符字符。这个对插图 2 的扩展是明显的，并且在插图 3 中显示。我们随后重新编译 C 编译器，但我们得到了一个问题。显然，这个二进制版本的编译器不知道什么是 &lt;code class=&quot;highlighter-rouge&quot;&gt;\v&lt;/code&gt;，源码并不是合法的 C 代码。我们必须「训练」编译器。在它知道 &lt;code class=&quot;highlighter-rouge&quot;&gt;\v&lt;/code&gt; 是什么后，我们的新改动会变成合法的 C 代码。我们去查了查 ASCII 表格，发现垂直制表符是十进制的 11。我们把我们的代码变得像插图 4 那样。现在老编译器接受了新代码。我们安装编译出来的二进制文件作为新的正式 C 编译器，并且现在我们可以写出方便的版本，就像插图 3 中那样。&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;'\\'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;'\\'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;'\\'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;'n'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;sc&quot;&gt;'\n'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;'v'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;11&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;em&gt;插图 4&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;这是一个深入的概念。这是我见过的很靠近「学习」程序的代码。你简要地辨别它一次，然后你可以用这个自引用的定义。&lt;/p&gt;

&lt;h4 id=&quot;第三步&quot;&gt;第三步&lt;/h4&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;compile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  	&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;em&gt;插图 5&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;再一次，在 C 编译器中，插图 5 显示了当例行代码「compile」被调用来编译下一行代码时对 C 编译器高级别的控制。插图 6 展示了一个对编译器简单的修改使得它当符合一个特定的模式时故意编译错源代码。如果这不是故意的，它被称为一个编译器「漏洞」。既然它是故意的，它应该被称为一个「特洛伊木马」。&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;compile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  	&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;match&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;pattern&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  		&lt;span class=&quot;n&quot;&gt;compile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;bug&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  	&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;em&gt;插图 6&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;我植入编译器的真实的代码会匹配 UNIX 中「login」命令的代码。这种替换代码可以错误编译 login 命令，所以它会接受将要加密的密码或是一个特定的已知密码。所以如果这段代码被安装到二进制文件中并且这个二进制文件被用来编译 login 命令，我就能以任意用户的身份自由驰骋于系统之中。&lt;/p&gt;

&lt;p&gt;这么明显的代码不会很长时间都不被发现的。即便是最偶然的细读代码也会招致怀疑。&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;compile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  	&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;match&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;pattern1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  		&lt;span class=&quot;n&quot;&gt;compile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;bug1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  	&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;match&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;pattern2&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  		&lt;span class=&quot;n&quot;&gt;compile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;bug2&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      	&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  	&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;em&gt;插图 7&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;最后一步在插图 7 中显示。这只是简单添加了第二个特洛伊木马到那个已经存在问题的代码中。第二段模式是作用于 C 编译器的。这个在第一步中自我复制的替换代码向编译器插入了两个特洛伊木马。这需要一个在第二步中的学习阶段。首先我们在正常 C 编译器上编译被修改过的代码来产生一个有问题的二进制文件。我们将这个二进制文件作为正式的 C 编译器。我们现在可以去除编译器代码中的漏洞，并且新二进制在它被编译时会被重新插入漏洞。当然了，那个 login 命令将会一直保留漏洞，而在代码中了无踪迹。&lt;/p&gt;

&lt;h4 id=&quot;寓意&quot;&gt;寓意&lt;/h4&gt;

&lt;p&gt;寓意很明显。你不能相信不是你自己写的代码。（特别是像招聘了我这样的人的公司的代码）没有代码级别的认证与检查会保护你不使用不可信任的代码。在证明了这种攻击的可行性后，我选中了 C 编译器。我本可以选择任何处理程序的程序，比如说汇编器、加载器，甚至于硬件微代码（microcode）。当程序的级别变得更低时，这些漏洞会变得越来越难找。一个恰当安装的微代码漏洞几乎是不可能发现的。&lt;/p&gt;

&lt;p&gt;在努力使你信服我不能被相信之后，我希望来说教一番。我想要批评媒体在处理「黑客」时的方式，比如说 414 帮、Dalton 帮之类的。这些小孩子做的行为是最具有破坏性的并且这些擅自进入与偷窃行为是最糟糕的。只是这些不充足的刑事规范使得他们免于极为严厉的起诉。受到这种行为影响的公司（最大的公司是非常容易受影响的）正在努力推进刑事规范的升级。未授权的计算机系统访问在一些州已是一个大问题，并且正在针对越来越多州的更多立法机构和议会。&lt;/p&gt;

&lt;p&gt;这种一触即发的状况正被酝酿。一方面，媒体、电视和电影正给这些蓄意破坏者造势，称他们为行家（？, whiz）小子；另一方面，这些小孩子做的行为很快会被年复一年的监禁处理。&lt;/p&gt;

&lt;p&gt;我看过一些孩子在议会前的作证。很明显，他们完全不知道他们行为的严重性。有一道很明显的文化代沟。这种闯入计算机系统的行为与闯入邻居家屋子的行为都是社会的耻辱。邻居家门关没关并没有什么关系。媒体必须认识到计算机的错误使用并不比酒后驾车有趣多少。&lt;/p&gt;</content>

      
      
      
      
      

      
        <author>
            <name>taoky</name>
          
          
        </author>
      

      
        <category term="随想" />
      

      
        <category term="安全" />
      
        <category term="信任" />
      
        <category term="系统" />
      

      
        <summary type="html">XcodeGhost 应该是创下了 App Store 的先河了，之前里面曾出现过的恶意软件应该不会超过个位数，但自从爆发之后，这种安全性就有点被打破了的味道。归根到底，就是开发者没有安全意识，或者说是过于天真吧。</summary>
      

      
      
    </entry>
  
  
  
    <entry>
      
      <title type="html">OS X 下的 App 数字证书和更多</title>
      
      
      <link href="https://taoky.github.io/2015-09-26/the-codesign-in-osx.html" rel="alternate" type="text/html" title="OS X 下的 App 数字证书和更多" />
      
      <published>2015-09-26T00:00:00+00:00</published>
      <updated>2015-09-26T00:00:00+00:00</updated>
      <id>https://taoky.github.io/2015-09-26/the-codesign-in-osx</id>
      <content type="html" xml:base="https://taoky.github.io/2015-09-26/the-codesign-in-osx.html">&lt;p&gt;最近的 XcodeGhost 事情闹得沸沸扬扬，大家都被吓得不轻。假的 Xcode 这么长时间没有被发现，一方面可能是关掉了 Gatekeeper 的原因；另一方面，有时开了 Gatekeeper 还是没有被检测出来，并且表面上是看不出来程序有没有数字签名的，不像 Windows 里面右键属性就可以看到。
&lt;!--more--&gt;&lt;/p&gt;
&lt;h3 id=&quot;gatekeeper-是什么它出了什么问题&quot;&gt;Gatekeeper 是什么？它出了什么问题？&lt;/h3&gt;

&lt;p&gt;Gatekeeper 可以检查下载到电脑中的 App 是否有数字签名，文件是否被篡改。如果检测到问题，它会停止应用的运行。然而，它只会检查从互联网上下载的应用。&lt;/p&gt;

&lt;p&gt;根据 Apple 官方给的&lt;a href=&quot;https://support.apple.com/zh-cn/HT202491&quot;&gt;帮助&lt;/a&gt;，Gatekeeper 在检测有问题的 App 时会有如下信息：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;仅允许 Mac App Store 应用时其它的应用都会被阻止，提示「打不开“XXX”，因为它不是从 Mac App Store 下载的。」&lt;/li&gt;
  &lt;li&gt;仅允许 Mac App Store 和被认可的开发者时未签名或已被篡改的应用会被阻止，提示「打不开“XXX”，因为它来自身份不明的开发者。」&lt;/li&gt;
  &lt;li&gt;允许任何来源时被篡改的应用仍然会被阻止，提示「“XXX”已损坏，打不开。您应该将它移到废纸篓。」&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;“不对啊，那 Gatekeeper 也应该检测出有问题的 Xcode 并阻止它运行啊。”&lt;/p&gt;

&lt;p&gt;Gatekeeper 是通过 com.apple.quarantine 标记来判断文件是否从互联网上下载的。标记可以用 &lt;code class=&quot;highlighter-rouge&quot;&gt;xattr&lt;/code&gt; 来查看。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;➜  Downloads  xattr -l *.app             
CheatSheet.app: com.apple.quarantine: 0023;00000000;The\x20Unarchiver;8F22E217-7ED8-44D7-B11F-88B319E5B82E
Retinizer.app: com.apple.quarantine: 0043;00000000;The\x20Unarchiver;5E278371-834C-4C31-BC70-58E89F7CD0AF
diumoo.app: com.apple.quarantine: 0003;00000000;The Unarchiver;C91583C2-3D0B-4639-A2D7-41C37AEF5650
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;这是 xattr 在我的电脑的下载目录里的运行结果。从 quarantine 中可知这三个应用都是从网络上下载的。（并且还有一些别的内容，比如说都是用「The Unarchiver」解压缩的）&lt;/p&gt;

&lt;p&gt;有些程序在下载的时候并没有设置 quarantine 标记，Gatekeeper 就不会检查，于是……（其实我觉得它不应该只检查从互联网上下载的应用，应该检查所有的应用才是正常的啊）&lt;/p&gt;

&lt;p&gt;再说了，就算 Gatekeeper 提示了问题，也挡不住想死的人的步伐：可以直接关掉 Gatekeeper，可以右键打开（打开过后 Gatekeeper 就再也不会检查），还可以在终端里开……&lt;/p&gt;

&lt;h3 id=&quot;检查数字签名&quot;&gt;检查数字签名&lt;/h3&gt;

&lt;p&gt;要检查应用的数字签名似乎只能在终端下。&lt;code class=&quot;highlighter-rouge&quot;&gt;codesign&lt;/code&gt; 和 &lt;code class=&quot;highlighter-rouge&quot;&gt;spctl&lt;/code&gt; 可以用来检查应用的数字签名。&lt;/p&gt;

&lt;h4 id=&quot;codesign&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;codesign&lt;/code&gt;&lt;/h4&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;codesign&lt;/code&gt; 可以来检查应用是否签名以及签名后是否被篡改。&lt;/p&gt;

&lt;p&gt;如果一切正常，显示如下：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;➜  /Applications  codesign -vv iTunes.app 
iTunes.app: valid on disk
iTunes.app: satisfies its Designated Requirement
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;如果应用被篡改过，显示如下：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;➜  /Applications  codesign -vv VLC.app 
VLC.app: a sealed resource is missing or invalid
file added: /Applications/VLC.app/Contents/MacOS/plugins/plugins.dat
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;如果应用压根没有签名，显示如下：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;➜  /Applications  codesign -vv OnyX.app 
OnyX.app: code object is not signed at all
In architecture: x86_64
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;spctl&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;spctl&lt;/code&gt;&lt;/h4&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;spctl&lt;/code&gt; 可以用来看是谁给应用签名，当然也可以同时检查签名是否正常。&lt;/p&gt;

&lt;p&gt;系统应用：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;➜  /Applications  spctl -avv iTunes.app 
iTunes.app: accepted
source=Apple System
origin=Software Signing
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Mac App Store 上下载的应用：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;➜  /Applications  spctl -avv GeoGebra\ 5.app 
GeoGebra 5.app: accepted
source=Mac App Store
origin=Apple Mac OS Application Signing
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;其它开发者（就是 Gatekeeper 里面的「被认可的开发者」）授权获得的证书签名的应用：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;➜  /Applications  spctl -avv NeteaseMusic.app 
NeteaseMusic.app: accepted
source=Developer ID
origin=Developer ID Application: NetEase (Hangzhou) Network Co., Ltd. (J669Y64Z9Y)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;被篡改过的应用：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;➜  /Applications  spctl -avv VLC.app 
VLC.app: a sealed resource is missing or invalid
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;没有签名的应用：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;➜  /Applications  spctl -avv OnyX.app        
OnyX.app: rejected
source=no usable signature
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;如果说这个应用的签名者有问题（比如像 Windows 里面，从百度一不小心下载的 Chrome 安装包却是百度的签名）的话，那这个应用也是有问题的。&lt;/p&gt;

&lt;p&gt;以上。&lt;/p&gt;</content>

      
      
      
      
      

      
        <author>
            <name>taoky</name>
          
          
        </author>
      

      
        <category term="安全" />
      

      
        <category term="数字证书" />
      
        <category term="安全" />
      
        <category term="App" />
      

      
        <summary type="html">最近的 XcodeGhost 事情闹得沸沸扬扬，大家都被吓得不轻。假的 Xcode 这么长时间没有被发现，一方面可能是关掉了 Gatekeeper 的原因；另一方面，有时开了 Gatekeeper 还是没有被检测出来，并且表面上是看不出来程序有没有数字签名的，不像 Windows 里面右键属性就可以看到。 Gatekeeper 是什么？它出了什么问题？</summary>
      

      
      
    </entry>
  
  
  
    <entry>
      
      <title type="html">杂记</title>
      
      
      <link href="https://taoky.github.io/2015-09-03/somethink.html" rel="alternate" type="text/html" title="杂记" />
      
      <published>2015-09-03T00:00:00+00:00</published>
      <updated>2015-09-03T00:00:00+00:00</updated>
      <id>https://taoky.github.io/2015-09-03/somethink</id>
      <content type="html" xml:base="https://taoky.github.io/2015-09-03/somethink.html">&lt;p&gt;我发现似乎我在暑假里并没有在这里写过东西，或者说这里看上去已经「荒废」掉了。当然其中的主要原因是时间分配问题：当我想写点什么的时候发现没有时间，当我有时间的时候我什么都不想写了。而且我本来意图是想把这里变成一个共同记录下生活与技术的地方。结果现在我更想写生活，但又不想透露出所有的事情，总之内心的想法很复杂，但总也实现不了啦。&lt;/p&gt;

&lt;p&gt;暑假里只是对网页的代码做了一点极小的「更新」。加引号是因为加的部分没啥用，只是使用 Javascript 做一下尝试罢了。&lt;/p&gt;

&lt;p&gt;开学前一天我发现连接似乎超时了，所以我那时在找替代方案，但是现在可以连了，替代方案什么的以后再说吧。
&lt;!--more--&gt;
—&lt;/p&gt;

&lt;p&gt;记得我在暑假开始的时候计划学一下 Qt，可是学了几天后我很快就遇到了瓶颈（比我想象的来得快得多）：C++ 的各种面向对象的特性，因为我平时都不用（估计是写竞赛代码写习惯了），所以要花很长时间反应：「咦，这是什么鬼，还能这么写！」，信号槽也在一开始把我坑得死去活来，主要是 Qt 5 后的新信号槽语法有时候会碰到函数重载冲突的问题，然而新语法可以在编译时检测编写错误；旧语法虽然没有这个问题，但不能在编译时检测。于是最后我决定……还是等上大学的时候再学吧。高中留下的时间不太多了。&lt;/p&gt;

&lt;p&gt;其实我一开始想学的时候是有最终计划的，想写个小程序在她生日的时候送给她。但自然地，现在这个计划就完不成了。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;暑假一开始放假的时候觉得很开心，虽然被统一「克扣」了十天的假期。后来生病了，发高烧连续十天（当然三天后吃退烧药可以退，但会反复），一直在医院和家中往返，最后还住进了观察室（这是第二次了）。扎针扎多了的感觉极为不好受，时间长了手都是僵硬的。第一天我跟老邓说我发烧的时候她说「生病很幸福」，在那几天我从未感受到这一点。后来想通了，也许的确是这样，仅限于在要上学的时候生 2～3 天就好的小病。&lt;/p&gt;

&lt;p&gt;可这是暑假时光啊，可这用了我十天时间啊。&lt;/p&gt;

&lt;p&gt;当然，从辩证法的角度来讲，生病也有它好的一面。那段时间里我认识了不少药物的名字（尽管现在全忘了），知道了退烧药会让白细胞数量下降（差点降到临界值），品尝了 KCl 的味道（难喝死了！），同时观察室有免费的 Wi-Fi 连接，听了一些新歌……还有，观察室的医生劝我学医（虽然我一直决心进计算机系）。&lt;/p&gt;

&lt;p&gt;生病给我带来的直接后果是：作业来不及了。我现在仍对「智慧」这篇作文记忆犹新，因为它花费了我三天的时间我才写完，而最后那天是 8 月 30 日。不过当我知道老邓的作业进程比我还慢时心里稍微安定了些（这不知是不是算是幸灾乐祸吧）。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;写到这里我突然想到我必须要吐槽&lt;del&gt;一个&lt;/del&gt;两个东西：OS X Yosemite 和 iOS 7 / 8。&lt;/p&gt;

&lt;p&gt;记得我在&lt;a href=&quot;/2014-12-31/hello-2015.html&quot;&gt;这篇&lt;/a&gt;开头曾经称赞过 OS X。确实不错。但是自打 Apple 进入扁平化之后就明显感觉 bug 在飞速增多。举个例子，OS X 10.10.4 之前采用了新的 DNS 解析进程 discoveryd 替代老的 mDNSResponder，据说是有人看到 mDNSResponder 里面解决跨平台问题的代码太多，于是重新写了一个。可是新的 discoveryd 里面的 bug 实在太多……于是 10.10.4 后又换回来了。&lt;/p&gt;

&lt;p&gt;唉。升级之后的明显感觉就是大问题没有，小问题不少，而且速度也不快。&lt;/p&gt;

&lt;p&gt;等 9 月 9 日的 WWDC 推出 OS X El Capitan 和 iOS 9 吧。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;说到 OS X El Capitan，我突然想到了新的「rootless」特性，就是被称为「系统完整性保护」（System Integrity Protection, SIP）的特性。简单的说，就是即便获得了 root（系统最高管理员）的权限，也没有什么用，系统文件还是改不了。&lt;/p&gt;

&lt;p&gt;不知道我那时候还能不能用得习惯了。而且如果 iOS 9 也有这个特性的话，可以想象越狱的难度会进一步加大。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;8 月 20 日至 27 日是去学校信息集训。有趣的是，物理和化学的时间与这是相同的，于是上下午机房里只有四个人，后来人稍微多了点。&lt;/p&gt;

&lt;p&gt;集训主要内容就是刷题，这个没有什么好说的。坐在我右边的是钱逗，他这几天就是刷一会儿题目再浪一会儿。他用 Windows API 写了一个屏幕彩色闪烁的程序，后来这个程序的功能越来越多，我也「帮」他找出了不少 bug，比如说输入字母会无法返回选择菜单（他不准备修），输入 -1 会越界访问其它内存的内容然后崩溃掉之类。当然我们还开发了一种名为「256 色」的娱乐项目。&lt;/p&gt;

&lt;p&gt;其实只用机房里的电脑娱乐是有很多方法的，比如说一直输出 &lt;code class=&quot;highlighter-rouge&quot;&gt;\a&lt;/code&gt;（这会让电脑一直发出滴滴声，而且窗口会关不掉），用 Windows API 的 &lt;code class=&quot;highlighter-rouge&quot;&gt;Beep()&lt;/code&gt; 发出不同旋律的声音。只是后来我们玩得太过头，结果老师把声卡驱动直接删掉（电脑不能直接连外网，每次启动自动恢复硬盘），顺带禁用了很多东西（似乎是用组策略干的）：任务管理器、控制面板、MMC……&lt;/p&gt;

&lt;p&gt;但是你要知道，只要想玩，总是可以找到玩的方法的。钱逗一开始把「开始菜单」的样式切换了一下，然后就发现了 Outlook Express，顺带给自己起了个英文名：John Smith（这是 Outlook Express 的示例名称）。不久后他在某程序上点了右键属性，发现了「兼容模式」，又发现点击「用 256 色运行」后会有复古效果出现，于是我们就开始玩了。&lt;/p&gt;

&lt;p&gt;首先我发现在 explorer.exe 上加选项，然后到「网上邻居」里面让资源管理器卡死重启就能有很长时间的效果了；之后我又想到在 Dev-C++（这是我们用的 IDE）的 ConsolePauser.exe 或者是 g++.exe 上加选项可以有「暂时」而烦人的效果；最后，他发现控制台程序加选项后 Alt + Enter 全屏之后退出会有永久的 256 色效果……&lt;/p&gt;

&lt;p&gt;我们真是一群无聊的人。我还用了一种捉弄钱逗的极好方法：在 iostream.h 里面加 &lt;code class=&quot;highlighter-rouge&quot;&gt;#include &amp;lt;con&amp;gt;&lt;/code&gt;，然后……hhh（仅限 Windows）。&lt;/p&gt;

&lt;p&gt;隔壁的机房在空闲的时候也是可以去的。那儿有 4 台 Mac，虽然一台坏了，只会在开机的时候嘟嘟叫，还有很多 PC 台式机。有一台 Mac 上面装了游戏「地狱边界」（LIMBO），于是我们都围在一起玩出主意。&lt;/p&gt;

&lt;p&gt;有天在科技夏令营的那天学校里还看到爽哥，那天还拿到了一张奖状，这是后话了。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;开学换了新班级，从 4 到 2，不过高二（2）班写得、叫得都比较顺。第一天我想竞选电教，失败了。不过老邓在文强挺顺的，当了班长。还有「她」在新班级还是和爽哥一个班，不是班长了，变成了团支书。&lt;/p&gt;

&lt;p&gt;当然班干部什么的，我现在不怎么关心了。初中安心当了三年电教之后，现在在管人和管机器中选择，我一定会选择管机器的——机器好弄，而人心难测。&lt;/p&gt;

&lt;p&gt;新班级的同学大多不认识，老师几乎全换，不适应肯定是有的。同学们都很友好，不过说一句坏话，谁知道他们（和我）以后会变成怎样呢？&lt;/p&gt;

&lt;p&gt;这是个大坑，以后找时间再填吧。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;说到「她」。不知道她在新班级怎样？开心吗？有什么变化吗？她，还是她吗？&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;我们「四人小组」在这个暑假里进行了第一次聚会。&lt;/p&gt;

&lt;p&gt;其实这个「四人小组」还是一开始我取的名字，因为讨论组没有名字，我就加了一个临时的，没有到用了近一年。后来经过老邓和爽哥的提议，最终变成了「四个卖女孩的小火柴」（这名字个人觉得有点二，不过他们都喜欢）。&lt;/p&gt;

&lt;p&gt;时间在 8 月 6 日，因为爽哥要乘公交早点回去，所以时间只能用来吃顿饭再粗略逛下街。地点在苏宁广场和南长街中选择，然后我用 Python 写了一个简单的程序随机选择。于是随机数&lt;del&gt;之神&lt;/del&gt;选择了南长街。&lt;/p&gt;

&lt;p&gt;然后我们就在那儿聚会啦（好吧我一开始还找不到那儿），吃了顿饭，味道不错，虽然我聊天的能力不强。吃完之后就逛街，大家都很开心。&lt;/p&gt;

&lt;p&gt;我就粗略地写写吧，让老邓来写会比我好得多的。&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;暑假的坑差不多填完了。我刚才在想，我洋洋洒洒写了三千多字是在写给谁看呢？网站的访问统计代码去年就去掉了，我不知道有没有别人会看我写的东西——估计是没有的，毕竟我没有做任何的 SEO 优化之类乱七八糟的玩意儿。&lt;/p&gt;

&lt;p&gt;我是在写给我自己看。这些文字是我处在某个时间段时候的记录。就像很多人都记日记一样，我也就在这里写点东西。若干年后回头看一看，或许会是「我那时候竟然这么幼稚」或者是「我那时怎么想到的」。至于把它们写在网站里，也许是出自一种「自豪感」，至少自己写的东西能够在互联网上呈现出来，而且样式（CSS）是可以控制的，可以以自己想要的方式呈现出来。它们也许比一粒沙子还小，但如果会有人看呢？（所以有一个没什么用的评论系统）&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;最后：高二，加油！&lt;/p&gt;</content>

      
      
      
      
      

      
        <author>
            <name>taoky</name>
          
          
        </author>
      

      
        <category term="生活" />
      

      
        <category term="杂记" />
      

      
        <summary type="html">我发现似乎我在暑假里并没有在这里写过东西，或者说这里看上去已经「荒废」掉了。当然其中的主要原因是时间分配问题：当我想写点什么的时候发现没有时间，当我有时间的时候我什么都不想写了。而且我本来意图是想把这里变成一个共同记录下生活与技术的地方。结果现在我更想写生活，但又不想透露出所有的事情，总之内心的想法很复杂，但总也实现不了啦。</summary>
      

      
      
    </entry>
  
  
  
    <entry>
      
      <title type="html">Markdown 简要使用手册</title>
      
      
      <link href="https://taoky.github.io/2015-06-20/introduction-to-markdown.html" rel="alternate" type="text/html" title="Markdown 简要使用手册" />
      
      <published>2015-06-20T00:00:00+00:00</published>
      <updated>2015-06-20T00:00:00+00:00</updated>
      <id>https://taoky.github.io/2015-06-20/introduction-to-markdown</id>
      <content type="html" xml:base="https://taoky.github.io/2015-06-20/introduction-to-markdown.html">&lt;p&gt;Markdown 是一种简单易用的标记语言。它被用来编写简单的多格式的文档，语法简单。纵使你不了解它的语法，你也非常容易看懂 Markdown 文档。它可以被转换为 HTML。它有助于编写结构化的文档，实现内容与结构的&lt;del&gt;有机统一&lt;/del&gt;分离。（简单的说，就是 Markdown 写的是结构，至于长什么样子是 CSS 的事）
&lt;!--more--&gt;
初次使用时注意一个特点：段与段之间需要空一行。不然下面的文档：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;First line
Second line
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;会变成以下 HTML 代码：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;p&amp;gt;First line
Second line&amp;lt;/p&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;在 &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;p&amp;gt;&lt;/code&gt; 标签中有空行，然而这并没有什么用，显示结果是：&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;First line
Second line&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;另外，当有一些「特殊的字符」时，需要在字符前加入「\」（反斜杠），不然 Markdown 会解析成别的东西。&lt;/p&gt;

&lt;h3 id=&quot;标题&quot;&gt;标题&lt;/h3&gt;

&lt;p&gt;使用：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# Heading 1
## Heading 2
### Heading 3
#### Heading 4
##### Heading 5
###### Heading 6
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Markdown 将根据 # 的个数，分别使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;h1&amp;gt;&lt;/code&gt; 到 &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;h6&amp;gt;&lt;/code&gt; 的标签显示标题。&lt;/p&gt;

&lt;h3 id=&quot;引用&quot;&gt;引用&lt;/h3&gt;

&lt;p&gt;使用：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;gt; 640 K ought to be enough for anybody.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;显示为：&lt;/p&gt;

&lt;hr /&gt;
&lt;blockquote&gt;
  &lt;p&gt;640 K ought to be enough for anybody.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;列表&quot;&gt;列表&lt;/h3&gt;

&lt;h4 id=&quot;无序列表&quot;&gt;无序列表&lt;/h4&gt;

&lt;p&gt;使用：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;* Review lessons
* Update software
* Write an article
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;（&lt;code class=&quot;highlighter-rouge&quot;&gt;*&lt;/code&gt; 也可以用 &lt;code class=&quot;highlighter-rouge&quot;&gt;-&lt;/code&gt;）&lt;/p&gt;

&lt;p&gt;显示为：&lt;/p&gt;

&lt;hr /&gt;
&lt;ul&gt;
  &lt;li&gt;Review lessons&lt;/li&gt;
  &lt;li&gt;Update software&lt;/li&gt;
  &lt;li&gt;Write an article&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h4 id=&quot;有序列表&quot;&gt;有序列表&lt;/h4&gt;

&lt;p&gt;使用：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;1. Install OS X 10.10
2. Open 'Terminal.app'
3. Input 'ls'
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;显示为：&lt;/p&gt;

&lt;hr /&gt;
&lt;ol&gt;
  &lt;li&gt;Install OS X 10.10&lt;/li&gt;
  &lt;li&gt;Open ‘Terminal.app’&lt;/li&gt;
  &lt;li&gt;Input ‘ls’&lt;/li&gt;
&lt;/ol&gt;

&lt;hr /&gt;

&lt;p&gt;不管序号前面的数字是什么，这个列表都会按正整数顺序输出。&lt;/p&gt;

&lt;p&gt;注意：列表包含多个段落时需要缩进（四个空格或一个制表符），像这样：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;1. Today is a nice day.

	I hope you will think so.
	
2. Sorry.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;代码&quot;&gt;代码&lt;/h3&gt;

&lt;h4 id=&quot;区块代码&quot;&gt;区块代码&lt;/h4&gt;

&lt;p&gt;使用：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;```
#include &amp;lt;stdio.h&amp;gt;

int main(void)
{
	printf(&quot;Hello, world!\n&quot;);
	return 0;
}
```
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;或者每行前加入缩进。&lt;/p&gt;

&lt;p&gt;显示为：&lt;/p&gt;

&lt;hr /&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;#include &amp;lt;stdio.h&amp;gt;

int main(void)
{
	printf(&quot;Hello, world!\n&quot;);
	return 0;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h4 id=&quot;行内代码&quot;&gt;行内代码&lt;/h4&gt;

&lt;p&gt;使用：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;The first line of the code of a HTML5 web page is ``&amp;lt;!DOCTYPE html&amp;gt;``.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;显示为：&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;The first line of the code of a HTML5 web page is &lt;code class=&quot;highlighter-rouge&quot;&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/span&gt;&lt;/code&gt;.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;如果代码内无 &lt;code class=&quot;highlighter-rouge&quot;&gt;`&lt;/code&gt;，也可以使用 &lt;code class=&quot;highlighter-rouge&quot;&gt;`Code Inside...`&lt;/code&gt; 单个包裹。&lt;/p&gt;

&lt;h3 id=&quot;分隔符&quot;&gt;分隔符&lt;/h3&gt;

&lt;p&gt;使用：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;---
***
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;都可以。&lt;/p&gt;

&lt;h3 id=&quot;文本强调&quot;&gt;文本强调&lt;/h3&gt;

&lt;p&gt;使用：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;**Attention!**: System will close all connections in 30 minutes!

*Isn't it amazing?*
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;显示为：&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;&lt;strong&gt;Attention!&lt;/strong&gt;: System will close all connections in 30 minutes!&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Isn’t it amazing?&lt;/em&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;其它文本行内样式部分&quot;&gt;其它文本行内样式（部分）&lt;/h3&gt;

&lt;p&gt;注意：部分程序可能不支持。不同程序可能支持标准不同。&lt;/p&gt;

&lt;p&gt;使用：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;~~What I said is wrong.~~

&amp;lt;http://www.github.com&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;显示为：&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;&lt;del&gt;What I said is wrong.&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.github.com&quot;&gt;http://www.github.com&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;图片&quot;&gt;图片&lt;/h3&gt;

&lt;p&gt;使用：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;![Test (Alt Text)](/pictures/md/test.png &quot;Photo in markdown&quot;)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;显示为：&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;&lt;img src=&quot;/pictures/md/test.png&quot; alt=&quot;Test (Alt Text)&quot; title=&quot;Photo in markdown&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;其中引号内可选。&lt;/p&gt;

&lt;p&gt;或者是「参考式」：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;![Test (Alt Text)][2536]
[2536]: /pictures/md/test.png &quot;Photo in markdown&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;链接&quot;&gt;链接&lt;/h3&gt;

&lt;p&gt;使用：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Fork this repo: [website](&quot;http://www.github.com&quot; &quot;GitHub&quot;)

Wikipedia: [English][wiki]

[wiki]: http://en.wikipedia.org &quot;Wikipedia&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;显示为：&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;Fork this repo: &lt;a href=&quot;&amp;quot;http://www.github.com&amp;quot;&quot; title=&quot;GitHub&quot;&gt;website&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Wikipedia: &lt;a href=&quot;http://en.wikipedia.org&quot; title=&quot;Wikipedia&quot;&gt;English&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;同样，引号可选。&lt;/p&gt;

&lt;h3 id=&quot;表格&quot;&gt;表格&lt;/h3&gt;

&lt;p&gt;注意：部分程序可能不支持&lt;/p&gt;

&lt;p&gt;使用：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Name  | Class
------------- | -------------
Alice  | 1
Bob  | 2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;显示为：&lt;/p&gt;

&lt;hr /&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Name&lt;/th&gt;
      &lt;th&gt;Class&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Alice&lt;/td&gt;
      &lt;td&gt;1&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Bob&lt;/td&gt;
      &lt;td&gt;2&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;hr /&gt;

&lt;p&gt;可以设置对齐：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;| Application  | Operating System  | Latest Version |
|:------------- |:---------------:| -------------:|
| Microsoft Office | Windows, OS X | 2013 |
| iTunes      | Windows, OS X | 12 |
| Google Chrome | Windows, Linux, OS X        | 43 |
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;显示为：&lt;/p&gt;

&lt;hr /&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Application&lt;/th&gt;
      &lt;th style=&quot;text-align: center&quot;&gt;Operating System&lt;/th&gt;
      &lt;th style=&quot;text-align: right&quot;&gt;Latest Version&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Microsoft Office&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Windows, OS X&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;2013&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;iTunes&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Windows, OS X&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;12&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Google Chrome&lt;/td&gt;
      &lt;td style=&quot;text-align: center&quot;&gt;Windows, Linux, OS X&lt;/td&gt;
      &lt;td style=&quot;text-align: right&quot;&gt;43&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;hr /&gt;

&lt;p&gt;第一列左对齐，第二列居中对齐，第三列右对齐。&lt;/p&gt;</content>

      
      
      
      
      

      
        <author>
            <name>taoky</name>
          
          
        </author>
      

      
        <category term="Markdown" />
      

      
        <category term="Markdown" />
      
        <category term="手册" />
      

      
        <summary type="html">Markdown 是一种简单易用的标记语言。它被用来编写简单的多格式的文档，语法简单。纵使你不了解它的语法，你也非常容易看懂 Markdown 文档。它可以被转换为 HTML。它有助于编写结构化的文档，实现内容与结构的有机统一分离。（简单的说，就是 Markdown 写的是结构，至于长什么样子是 CSS 的事） 初次使用时注意一个特点：段与段之间需要空一行。不然下面的文档：</summary>
      

      
      
    </entry>
  
  
  
    <entry>
      
      <title type="html">KDE 5 体验：「一下拍扁」</title>
      
      
      <link href="https://taoky.github.io/2015-02-14/flat-kde5-trial.html" rel="alternate" type="text/html" title="KDE 5 体验：「一下拍扁」" />
      
      <published>2015-02-14T00:00:00+00:00</published>
      <updated>2015-02-14T00:00:00+00:00</updated>
      <id>https://taoky.github.io/2015-02-14/flat-kde5-trial</id>
      <content type="html" xml:base="https://taoky.github.io/2015-02-14/flat-kde5-trial.html">&lt;p&gt;今天……嗯……是情人节暨世界癫痫日。我既没有女生喜欢，又没有癫痫，所以今天还是一个平常的日子。当我看到下载堆栈里的 KDE 5 的体验光盘文件的时候，我想，要不今天不写研究性学习报告了，放松一下，来看看 KDE 最近发展的情况吧。&lt;/p&gt;

&lt;p&gt;在用 OS X 之前，我用的操作系统是 Linux，发行版是 Fedora，桌面环境是 KDE。这是一个不错的桌面环境，并且我也不太喜欢 GNOME、Unity 之类的，自然便投向了 Qt 系的桌面环境。只是换了 OS X 之后不再怎么用 Linux 了。那时的 KDE 应该是到了 4.11 吧，稳定性尚可，但有时还会崩溃，更多的是直接卡住。卡着的时候我便知道八成又是用了 swap，swap 一用太多就卡的很。
&lt;!--more--&gt;
似乎扯得太多了，直接开始看吧。当然因为是虚拟机试用，所以动画效果之类的会有些缓慢。&lt;/p&gt;

&lt;p&gt;我用的是 KDE 提供的&lt;a href=&quot;http://files.kde.org/snapshots/neon5-latest.iso.mirrorlist&quot;&gt;体验光盘文件&lt;/a&gt;，下载完一开始用的时候发现这张 LiveCD 提供的内容很不全：有中文翻译，但没有中文字体，于是中文字便直接变为「方块字」，没有 PDF 阅读器，自带的浏览器 Konqueror 只有 KHTML 内核的。KHTML 其实还是 WebKit 的源头，但现在已不怎么能跟得上这个 HTML 5 的时代了。&lt;/p&gt;

&lt;p&gt;于是尝试配置源下载点东西，但最后放弃了。主要原因是：分配的内存太小，下载一些东西就快用完了（我没分配硬盘）。所以我还是看英文好了。&lt;/p&gt;

&lt;h3 id=&quot;新的扁平风格看上去不错&quot;&gt;新的扁平风格：看上去不错&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;http://taoky.github.io/pictures/kde5/login-screen.png&quot; alt=&quot;登陆界面&quot; /&gt;&lt;/p&gt;

&lt;p&gt;登陆的界面很现代化，进入之后可以明显注意到 KDE 5 正在尝试一步步抛弃 KDE 4 时代的毛玻璃、立体化（或者说叫拟物化）效果。进入 KDE 的 System Settings，可以明显发现默认的主题已不再是 Oxygen，而是一款新主题：Breeze。从桌面风格、鼠标指针、锁屏界面、KDE 程序风格都发生了较大的变化，除了窗口边框仍然是 Oxygen（但也可以换成 Breeze）以外，其它组件的外貌都变了。从中可以体现出 KDE 开发成员已经在抛弃拟物，尝试扁平。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://taoky.github.io/pictures/kde5/all-breeze.png&quot; alt=&quot;Breeze 风格&quot; /&gt;&lt;/p&gt;

&lt;p&gt;准确地说，KDE 有一点点 Windows 8 设计风格的感觉，但不是很明显。OS X 的影子还是可以体现出来的。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://taoky.github.io/pictures/kde5/KDE5-style.png&quot; alt=&quot;KDE 窗口效果&quot; /&gt;&lt;/p&gt;

&lt;p&gt;下面放几张图，大家看看吧。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://taoky.github.io/pictures/kde5/appearance-1.png&quot; alt=&quot;Appearance 1&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://taoky.github.io/pictures/kde5/appearance-2.png&quot; alt=&quot;Appearance 2&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://taoky.github.io/pictures/kde5/appearance-3.png&quot; alt=&quot;Appearance 3&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://taoky.github.io/pictures/kde5/appearance-4.png&quot; alt=&quot;Appearance 4&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://taoky.github.io/pictures/kde5/appearance-5.png&quot; alt=&quot;Appearance 5&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;速度与稳定性&quot;&gt;速度与稳定性&lt;/h3&gt;

&lt;p&gt;嗯，估计是由于使用虚拟机的缘故，KDE 5 的表现并不好。速度不快，但一般也不怎么卡，如果开的程序太多分配的内存不太够的话 Plasma 或者其它的 KDE 进程就会崩溃，也有可能死机。&lt;/p&gt;

&lt;p&gt;至于放在真机上 KDE 5 的表现会如何就不清楚了。小内存的机器运行会~~略~~有较大压力。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://taoky.github.io/pictures/kde5/crash-kde.png&quot; alt=&quot;KDE 的崩溃&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;一些问题&quot;&gt;一些问题&lt;/h3&gt;

&lt;p&gt;不少程序（Dolphin、Konqueror……几乎除了 System Settings 以外都是）仍然还是 KDE 4 的风格，似乎使用的是 QtCurve 的风格，与新风格非常不协调。并且似乎并没有准备好给 GTK 程序的主题。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://taoky.github.io/pictures/kde5/KDE5-and-4.png&quot; alt=&quot;KDE 5 与 KDE 4&quot; /&gt;&lt;/p&gt;

&lt;p&gt;PS：KDE 5 关于窗口的左边的吉祥物很可爱啊。&lt;/p&gt;

&lt;p&gt;同时也发现了一个 Bug：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://taoky.github.io/pictures/kde5/bug-1.png&quot; alt=&quot;一个小 Bug&quot; /&gt;&lt;/p&gt;</content>

      
      
      
      
      

      
        <author>
            <name>taoky</name>
          
          
        </author>
      

      
        <category term="KDE" />
      

      
        <category term="KDE 5" />
      
        <category term="Linux" />
      

      
        <summary type="html">今天……嗯……是情人节暨世界癫痫日。我既没有女生喜欢，又没有癫痫，所以今天还是一个平常的日子。当我看到下载堆栈里的 KDE 5 的体验光盘文件的时候，我想，要不今天不写研究性学习报告了，放松一下，来看看 KDE 最近发展的情况吧。</summary>
      

      
      
    </entry>
  
  
  
    <entry>
      
      <title type="html">Hello, 2015!</title>
      
      
      <link href="https://taoky.github.io/2014-12-31/hello-2015.html" rel="alternate" type="text/html" title="Hello, 2015!" />
      
      <published>2014-12-31T00:00:00+00:00</published>
      <updated>2014-12-31T00:00:00+00:00</updated>
      <id>https://taoky.github.io/2014-12-31/hello-2015</id>
      <content type="html" xml:base="https://taoky.github.io/2014-12-31/hello-2015.html">&lt;p&gt;嗯，是的。好像时间过得很快，2014 年春节时候整理照片的事情还记得清清楚楚，这一年的尾声就到了。怎么说好呢？我不知道。
&lt;!--more--&gt;&lt;/p&gt;
&lt;h2 id=&quot;look-back-on-2014&quot;&gt;Look back on 2014&lt;/h2&gt;

&lt;h3 id=&quot;第一台-mac和第一次体验-os-x&quot;&gt;第一台 Mac，和第一次体验 OS X&lt;/h3&gt;

&lt;p&gt;把这件事情写在最前面的原因很简单——OS X 给我留下了非常深刻的印象。事实上，你所看到的这段文字，正是在一台 Mac 上写下的。&lt;/p&gt;

&lt;p&gt;说实话，OS X 上的生活比在 Linux 下的条件好的多——有 QQ，不再寄托于 WebQQ；有 M$Office，不用再困扰于 LibreOffice 的兼容性问题，WPS（Beta / Alpha）的稳定性与功能不足。相比于 Windows，它的界面足够漂亮好用，而且还有一个不错的 Terminal，跟 Windows 近乎残废的 cmd.exe 比实在好太多—— cmd.exe 甚至连全屏显示都不行。&lt;/p&gt;

&lt;p&gt;从小细节上来说，OS X 也足够令人忘怀。Mac 有我用过的最好用的触摸板（所以我现在电脑旁边都没有鼠标），有全系统的字典，有特别棒的 Spotlight……&lt;/p&gt;

&lt;p&gt;若要问其问题，当然也有。比如说其相当诡异的「最大化」绿色按钮——在 OS X 10.9 及以下版本中，你永远都不会知道这个按钮的行为会是什么，每次按下去都充满惊喜！当然在 10.10 中改成全屏了，但用着很不习惯。另外，如果你想看几个文件合起来的大小，然后选中它们之后按下了 Command + I 的话——如果你弄了十几个文件，那就会有&lt;strong&gt;十几个&lt;/strong&gt;窗口弹出来，这个「用户体验」太爽了……&lt;/p&gt;

&lt;p&gt;当然，现在我用着还是蛮舒服的。&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;It just works.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Isn’t it?&lt;/p&gt;

&lt;h3 id=&quot;初中的黄金时代&quot;&gt;初中的「黄金时代」&lt;/h3&gt;

&lt;p&gt;现在，假使我有一台 Time Machine（当然不是 Mac 那个文件备份用的），那么我会选择回到何时？&lt;/p&gt;

&lt;p&gt;去掉一些对历史的好奇成分（比如说回到清朝看其如何灭亡之类），我会选择回到初三上半学期（事实上这很大一部分已经不属于 2014 了，但是我还是忍不住想说说）。&lt;/p&gt;

&lt;p&gt;首先初二上半学期肯定排除了，那是我初中度过的最可怕的时光，我差点和徐娟大打起来，小冲突几乎天天都有。下半学期和老茶坐一起的时候也不错，只是感觉比不上初三上半学期。&lt;/p&gt;

&lt;p&gt;记得初三上半学期一开始，忘了是谁想出来的主意，分了四个社（名字可能不叫「社」，记不清了）。那时我想，我语文不咋样，一直被阅读和作文坑（直到现在还是那样），于是我便最后选择了「文学社」。四个社，刚好分配成四个大组。于是我便分到了那一大组。同桌是老邓（当然不能在她面前这样叫她），后面二位是老温和爽爽，右边是老茶，前面是班长（初一时候是，初二初三时候就不是了，以下都是指她）。我那时应该想不到，我和老邓、老温、爽爽会形成一个固定的四人整体，在多次调换座位的时候固定住。当然，那时我只想到前面是班长，可以每天和她交流，这一点就够我高兴了。&lt;/p&gt;

&lt;p&gt;在这样一个奇特的环境之下，我们之间的相处还是挺融洽的。当然有些事情的发生还是比较奇怪的，比如我不知不觉间变成「0.5 个男的」，而老邓变成了 2 个，于是我们这个四人团体便变成了「4.5 个男的」，后面二位各占一个；还有一开始的时候，我那一大组的周围一圈人都在问我我喜欢谁……我最后跟老邓招了，她虽然保证替我保守秘密，但两个月后，爽爽就知道了，进入下半学期之后，又多两个人知道这件事；那时班长的同桌还固执地认为我喜欢另外一个女生——当然这是后话了。&lt;/p&gt;

&lt;p&gt;应该是期中考试之后的月考那次吧，座位换了。班长被调远了，但我们四个人还是没变（好像没什么事情发生，但我记得特别清楚）。&lt;/p&gt;

&lt;p&gt;为什么说这段时间是「黄金时代」？因为周围的环境好，在这样的环境里心情好，成绩也不错。&lt;/p&gt;

&lt;p&gt;就这样简单。&lt;/p&gt;

&lt;h3 id=&quot;高中四月记&quot;&gt;高中四月记&lt;/h3&gt;

&lt;p&gt;高中生活如果从九月开始计数的话，到现在已经四个月了。我来到了四班，一个人都不认识。我们四个人再也没法每天聚一块儿交流了，但我们到现在仍是一个整体。&lt;/p&gt;

&lt;p&gt;当然高中有很多地方都不错。例如社团、选修课（像我当然滚去信息社编程去了）、研究性学习（我和成员这次弄 STL）、还有竞赛（信息竞赛），当然学习压力也加大了，我还记得当初学匀加速、牛二、时的各种纠结，那真是痛苦的经历。&lt;/p&gt;

&lt;p&gt;信息竞赛用的是 C++，我以前只写过 C，不过竞赛用的 C++ 范围连「C with classes」都达不到，只是用 C 的语法，加上一些 STL 的内容——比如 &lt;code class=&quot;highlighter-rouge&quot;&gt;sort()&lt;/code&gt;、&lt;code class=&quot;highlighter-rouge&quot;&gt;swap()&lt;/code&gt; 之类罢了。社团没有共同的活动，选修课教 VB6（我其实更想用 Qt 写图形程序，但没那个能力），但到学期末连数组、&lt;code class=&quot;highlighter-rouge&quot;&gt;for&lt;/code&gt;、&lt;code class=&quot;highlighter-rouge&quot;&gt;while&lt;/code&gt; 都没学到（我对 VB 没多大兴趣，所以只是这样弄弄）。其中乐趣也是有的，比如说我们报信息的不用上音乐课啊，ASCII 里的 &lt;code class=&quot;highlighter-rouge&quot;&gt;\a&lt;/code&gt; 和 Windows API 里的 &lt;code class=&quot;highlighter-rouge&quot;&gt;Beep()&lt;/code&gt;，被我们用来编歌之类。&lt;/p&gt;

&lt;p&gt;住宿就没那么幸福了。当舍长需要承受老师和舍员带来的压力，并不是那么好当的。先写这么多吧。&lt;/p&gt;

&lt;h2 id=&quot;going-to-2015--2015-目标&quot;&gt;Going to 2015 —— 2015 目标&lt;/h2&gt;

&lt;p&gt;或许像这样的「目标」从某种意义上讲是一个特别虚的东西，你定下了它，在以后的时间里却被忘却。&lt;/p&gt;

&lt;p&gt;但我还是想写写。&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;找时间把我旁边那堆书慢慢读完（或许这个任务一年以内完不成）&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;继续努力学算法&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;继续能够稳定地在四班呆着&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;还有吗？以后再说吧。新年快到了。&lt;/p&gt;

&lt;p&gt;新年快乐。Hello, 2015!&lt;/p&gt;</content>

      
      
      
      
      

      
        <author>
            <name>taoky</name>
          
          
        </author>
      

      
        <category term="生活" />
      

      
        <category term="2015" />
      
        <category term="回忆" />
      

      
        <summary type="html">嗯，是的。好像时间过得很快，2014 年春节时候整理照片的事情还记得清清楚楚，这一年的尾声就到了。怎么说好呢？我不知道。 Look back on 2014</summary>
      

      
      
    </entry>
  
  
  
    <entry>
      
      <title type="html">渣翻译：Identifying Back Doors, Attack Points, and Surveillance Mechanisms in iOS Devices</title>
      
      
      <link href="https://taoky.github.io/2014-07-30/translation-iOS-backdoor.html" rel="alternate" type="text/html" title="渣翻译：Identifying Back Doors, Attack Points, and Surveillance Mechanisms in iOS Devices" />
      
      <published>2014-07-30T00:00:00+00:00</published>
      <updated>2014-07-30T00:00:00+00:00</updated>
      <id>https://taoky.github.io/2014-07-30/translation-iOS-backdoor</id>
      <content type="html" xml:base="https://taoky.github.io/2014-07-30/translation-iOS-backdoor.html">&lt;p&gt;似乎最近关于 iOS 被发现存在后门的事情传得火热，本着不怎么相信媒体评论，自己看传出后门的文档的想法，找到了源文档，顺便用了几个小时翻译了一遍。说是翻译，其实信达雅，一样都没有。有几个词出现很多次，但就算查了词典，也根本不知道是什么意思。我只能保证你看完翻译之后了解事情的大概情况。
&lt;!--more--&gt;
源文档：&lt;a href=&quot;http://www.zdziarski.com/blog/wp-content/uploads/2014/07/iOS_Backdoors_Attack_Points_Surveillance_Mechanisms_Moved.pdf&quot;&gt;Here&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;渣翻译文档：&lt;a href=&quot;/attachments/iOS_backdoor.pdf&quot;&gt;Here&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;以上。&lt;/p&gt;

&lt;p&gt;利益相关：OS X/Linux/Windows/iOS 用户。&lt;/p&gt;

&lt;p&gt;PS：Apple 回复原作者发现「后门」事件：&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;我们在设计iOS时，加入了设备诊断功能。这一功能的目的是向(用户所在的)公司的IT维护部门，程序设计者及苹果公司提供信息，以诊断设备。我们确保了这一“设备诊断”功能不会危害用户的隐私和信息安全。任何苹果设备都只有在解锁并连接至可信任的电脑后，苹果才会获取这些有限的诊断信息。如果用户没有同意分享这些信息，我们不会传输任何数据。&lt;/p&gt;
&lt;/blockquote&gt;</content>

      
      
      
      
      

      
        <author>
            <name>taoky</name>
          
          
        </author>
      

      
        <category term="翻译" />
      

      
        <category term="iOS" />
      
        <category term="英文" />
      
        <category term="后门" />
      
        <category term="漏洞" />
      

      
        <summary type="html">似乎最近关于 iOS 被发现存在后门的事情传得火热，本着不怎么相信媒体评论，自己看传出后门的文档的想法，找到了源文档，顺便用了几个小时翻译了一遍。说是翻译，其实信达雅，一样都没有。有几个词出现很多次，但就算查了词典，也根本不知道是什么意思。我只能保证你看完翻译之后了解事情的大概情况。 源文档：Here</summary>
      

      
      
    </entry>
  
  
  
    <entry>
      
      <title type="html">班级网页第二版发布！</title>
      
      
      <link href="https://taoky.github.io/2014-07-18/class-v2-published.html" rel="alternate" type="text/html" title="班级网页第二版发布！" />
      
      <published>2014-07-18T00:00:00+00:00</published>
      <updated>2014-07-18T00:00:00+00:00</updated>
      <id>https://taoky.github.io/2014-07-18/class-v2-published</id>
      <content type="html" xml:base="https://taoky.github.io/2014-07-18/class-v2-published.html">&lt;p&gt;班级网页第二版发布了！使用最新版本的 Bootstrap，全新扁平化设计，更好兼容手机、平板等移动设备，并抛弃对旧版本浏览器（IE 6/7）的支持。&lt;/p&gt;

&lt;p&gt;其实新版的班级网页是从八个月前（2013 年 11 月 17 日）开始做的（你没看错）。做了一天，约一个月后（12 月 8 日）又修修补补了一些东西，又两个月后又做了一小部分，然后一直烂尾到……中考结束才继续开始。&lt;/p&gt;

&lt;p&gt;现在我表示我终于熟悉用 jekyll 和 liquid 的使用了……表示 liquid 竟然不能进行文件的 I/O 操作，导致制作换页器的时候遇到了很大的阻力，用了两天才解决问题，貌似我踩到了一个坑吧……
&lt;!--more--&gt;
因为 GitHub 上「建议」不要放视频（也放不了，文件太大了），所以视频托管在优酷上，广告什么的我不负责。&lt;/p&gt;

&lt;p&gt;另外表示从老师博客上搜集文章也是一件很繁的事情。我居然打开了 Firefox（OS X 上 Firefox 的触摸板体验太差，所以我换 Chrome 了），用 DownThemAll 一页页翻出来下载，然后用 Sublime Text 的文件批量替换网页的各种格式（网易博客的 HTML 文件很乱，各种内嵌 CSS），最后转换成 Markdown，就花了我两天。&lt;/p&gt;

&lt;p&gt;另外压缩图片也很繁琐。表示压缩图片需要小心翼翼——可能一个参数没弄好，图片就糊了（在 Retina 屏幕上特别明显）。一开始图片有 &amp;gt;300 M，最后尝试各种压缩方法才压到 &amp;lt;1 M（当然图像的损失很多）。&lt;/p&gt;

&lt;p&gt;PS：OS X 上无损压缩可以用 ImageOptim，有损可以尝试安装 imagemagick，然后 &lt;code class=&quot;highlighter-rouge&quot;&gt;convert -resize 80%x80%&lt;/code&gt; [原图像] [目标图像] 来缩放，运行多次直到压缩到满意效果。&lt;/p&gt;

&lt;p&gt;最后发布的时候也踩到一个 jekyll 的大坑。我路径用的是 “/path/file” 这类的，结果放到子目录里面各种文件加载不出。结果新建一个 repo，定义变量 &lt;code class=&quot;highlighter-rouge&quot;&gt;site.baseurl&lt;/code&gt;，然后各种修改才解决……然后发现 https 的时候因为浏览器的安全规定文件加载不出，最后干脆用 &lt;code class=&quot;highlighter-rouge&quot;&gt;baseurl = https://...&lt;/code&gt; 这样了。&lt;/p&gt;

&lt;p&gt;不管怎么说，沉沉浮浮八个月，它终于上来了，不是吗 :-) ？&lt;/p&gt;

&lt;p&gt;附：
班级网页第二版地址：https://taoky.github.io/class-9/index.html&lt;/p&gt;

&lt;p&gt;源代码（jekyll）：https://github.com/taoky/ClassV2&lt;/p&gt;

&lt;p&gt;发布版本：https://github.com/taoky/class-9/tree/gh-pages&lt;/p&gt;</content>

      
      
      
      
      

      
        <author>
            <name>taoky</name>
          
          
        </author>
      

      
        <category term="班级" />
      

      
        <category term="班级" />
      
        <category term="网页" />
      
        <category term="Bootstrap" />
      

      
        <summary type="html">班级网页第二版发布了！使用最新版本的 Bootstrap，全新扁平化设计，更好兼容手机、平板等移动设备，并抛弃对旧版本浏览器（IE 6/7）的支持。</summary>
      

      
      
    </entry>
  
  
</feed>
